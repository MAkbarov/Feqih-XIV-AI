import{j as e,M as Lt,r as At,a as Et}from"./markdown-CGR2RDhP.js";import{a as c,L as G,b as B,H as qt}from"./vendor-4eYsLQor.js";import{I as u}from"./Icon-D8dZPIEy.js";import{a as ie,u as dt}from"./app-GJbzw1PY.js";import{F as Ft}from"./Footer-ClqF8xiF.js";import{A as Z}from"./index-DHi4oDk3.js";import{m as p}from"./proxy-CfrAqMoI.js";import{r as Bt}from"./index-Cn3or5DS.js";import"./app-Cn6opuke.js";const Ht=({className:l=""})=>{const{isDarkMode:r}=ie(),[s,y]=c.useState(null),[m,a]=c.useState(!0),[k,P]=c.useState(!1),[C,w]=c.useState(!1);c.useEffect(()=>{const v=localStorage.getItem("donation_dismissed_until"),S=Date.now();if(v&&S<parseInt(v)){w(!0),a(!1);return}_()},[]);const _=async()=>{try{const S=await(await fetch("/api/donation-settings")).json();S&&S.enabled&&(y(S),setTimeout(()=>{P(!0)},2e3))}catch(v){console.error("Error fetching donation settings:",v)}finally{a(!1)}},f=()=>{w(!0),P(!1)},N=()=>{const v=Date.now()+6048e5;localStorage.setItem("donation_dismissed_until",v.toString()),w(!0),P(!1)};return m||!s||C?null:e.jsx(Z,{children:k&&e.jsx(p.div,{className:"fixed inset-0 backdrop-blur-lg flex items-center justify-center z-50 p-4 modal-overlay",style:{background:r?"linear-gradient(135deg, rgba(31, 41, 55, 0.85) 0%, rgba(17, 24, 39, 0.9) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.85) 0%, rgba(255, 255, 255, 0.9) 100%) !important"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>P(!1),children:e.jsxs(p.div,{className:`max-w-md w-full rounded-3xl shadow-2xl relative overflow-hidden border-2 backdrop-blur-md modal-content donation-modal ${r?"dark":""} ${r?"border-gray-600/50":"border-gray-200/50"}`,style:{background:s.background_color||(r?"linear-gradient(135deg, rgba(31, 41, 55, 0.95) 0%, rgba(17, 24, 39, 0.98) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%) !important"),color:s.text_color||(r?"#ffffff !important":"#333333 !important"),backdropFilter:"blur(20px)",boxShadow:r?"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05)":"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1)"},initial:{scale:.8,opacity:0,y:50,rotateX:15},animate:{scale:1,opacity:1,y:0,rotateX:0},exit:{scale:.8,opacity:0,y:50,rotateX:15},transition:{type:"spring",damping:25,stiffness:300,duration:.5},whileHover:{scale:1.02,y:-5},onClick:v=>v.stopPropagation(),children:[e.jsx(p.button,{onClick:f,className:`absolute top-5 right-5 w-10 h-10 flex items-center justify-center rounded-full transition-all duration-300 z-10 text-xl font-medium ${r?"bg-gray-700/70 hover:bg-gray-600/80 text-gray-300 hover:text-white border border-gray-600/50":"bg-gray-100/70 hover:bg-gray-200/80 text-gray-600 hover:text-gray-800 border border-gray-200/50"}`,whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},children:"√ó"}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(p.h3,{className:"text-2xl font-bold mb-6 pr-10 leading-tight",style:{color:s.text_color||(r?"#ffffff":"#333333")},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.title}),e.jsx(p.div,{className:`text-base leading-relaxed prose max-w-none ${r?"dark:prose-invert":""}`,style:{color:s.text_color||(r?"#ffffff":"#333333"),"--tw-prose-body":s.text_color||(r?"#ffffff":"#333333"),"--tw-prose-headings":s.text_color||(r?"#ffffff":"#333333"),"--tw-prose-bold":s.text_color||(r?"#ffffff":"#333333"),"--tw-prose-links":s.text_color||(r?"#ffffff":"#333333")},dangerouslySetInnerHTML:{__html:s.content},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2}})]}),e.jsxs(p.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(p.div,{className:"flex-1",children:e.jsx(G,{href:"/donation",className:"w-full block px-6 py-4 rounded-xl font-bold text-white text-center transition-all duration-300 shadow-lg",style:{backgroundColor:s.button_color||"#3b82f6"},onMouseEnter:v=>{v.target.style.filter="brightness(110%)",v.target.style.transform="translateY(-2px)",v.target.style.boxShadow="0 20px 40px rgba(0,0,0,0.2)"},onMouseLeave:v=>{v.target.style.filter="brightness(100%)",v.target.style.transform="translateY(0px)",v.target.style.boxShadow="0 10px 25px rgba(0,0,0,0.1)"},children:"üíù D…ôst…ôk Ol"})}),e.jsx(p.button,{className:`px-6 py-4 rounded-xl font-medium transition-all duration-300 hover:shadow-md backdrop-blur-sm ${r?"text-gray-300 border border-gray-600/60 hover:bg-gray-700/60 hover:border-gray-500":"text-gray-600 border border-gray-300/60 hover:bg-gray-50/60 hover:border-gray-400"}`,onClick:f,whileHover:{scale:1.05},whileTap:{scale:.95},children:"Baƒüla"})]}),e.jsx(p.button,{className:`w-full text-sm underline transition-colors py-2 rounded-lg ${r?"text-gray-400 hover:text-gray-200 hover:bg-gray-700/30":"text-gray-500 hover:text-gray-700 hover:bg-gray-100/30"}`,onClick:N,whileHover:{scale:1.02},children:"1 h…ôft…ô g√∂st…ôrm…ô"})]})]})]})})})},Rt=({isOpen:l,onAccept:r,onReject:s,siteName:y="XIV AI"})=>{const{theme:m}=ie(),[a,k]=c.useState(!1),[P,C]=c.useState(null),[w,_]=c.useState(!0),f=async()=>{try{const v=await(await fetch("/api/guest-terms")).json();C(v)}catch{console.warn("Failed to fetch admin terms, using fallback"),C({title:"ƒ∞stifad…ô ≈û…ôrtl…ôri",content:"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"})}finally{_(!1)}};return c.useEffect(()=>{l&&!P&&f()},[l]),c.useEffect(()=>(l?(k(!0),document.body.style.overflow="hidden"):document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[l]),l?e.jsx(Z,{children:a&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:()=>s&&s()}),e.jsxs(p.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(u,{name:"shield_check",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:w?"ƒ∞stifad…ô ≈û…ôrtl…ôri":P?.title||"ƒ∞stifad…ô ≈û…ôrtl…ôri"}),e.jsx("p",{className:"text-blue-100 text-sm",children:y})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-96",children:w?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Y√ºkl…ônir..."})]}):e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:P?.content||"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"}})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color}15 0%, ${m.secondary_color||m.primary_color}15 100%)`:"linear-gradient(135deg, #10b98115 0%, #065f4615 100%)"},children:[e.jsxs("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(u,{name:"close",size:16}),e.jsx("span",{children:"R…ôdd et"})]}),e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)",filter:"brightness(1)",":hover":{filter:"brightness(1.1)"}},onMouseEnter:N=>N.target.style.filter="brightness(1.1)",onMouseLeave:N=>N.target.style.filter="brightness(1)",children:[e.jsx(u,{name:"shield_check",size:16}),e.jsx("span",{children:"Q…ôbul edir…ôm"})]})]})]})]})}):null},Gt=({isOpen:l,onConfirm:r,onCancel:s,chatTitle:y="",siteName:m=""})=>{const{theme:a}=ie();return l?e.jsx(Z,{children:e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:s}),e.jsxs(p.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:a?.primary_color?`linear-gradient(135deg, ${a.primary_color} 0%, ${a.secondary_color||a.primary_color} 100%)`:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(u,{name:"warning",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"S√∂hb…ôti Sil"}),e.jsx("p",{className:"text-blue-100 text-sm",children:m})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(u,{name:"warning",size:24,color:"#ef4444"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:"Bu s√∂hb…ôti silm…ôk ist…ôdiyinizd…ôn …ôminsiz?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Bu …ôm…ôl geri alƒ±na bilm…ôz."})]})]}),y&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Silin…ôc…ôk s√∂hb…ôt:"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:['"',y,'"']})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:a?.primary_color?`linear-gradient(135deg, ${a.primary_color}10 0%, ${a.secondary_color||a.primary_color}10 100%)`:"linear-gradient(135deg, #ef444415 0%, #dc262615 100%)"},children:[e.jsxs("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(u,{name:"close",size:16}),e.jsx("span",{children:"L…ôƒüv et"})]}),e.jsxs("button",{onClick:r,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl bg-red-500 hover:bg-red-600",children:[e.jsx(u,{name:"delete",size:16}),e.jsx("span",{children:"Sil"})]})]})]})]})}):null},Ut=({className:l="",chatbotName:r="AI Assistant"})=>{const{theme:s}=ie(),y=s?.primary_color||"#6366f1",m=s?.text_color||"#1f2937";return e.jsxs("div",{className:`inline-flex items-center space-x-3 px-4 py-2 rounded-full ${l}`,style:{backgroundColor:`${y}10`},children:[e.jsxs("span",{className:"text-sm font-semibold",style:{color:m},children:[r," yazƒ±r"]}),e.jsxs("div",{className:"flex space-x-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot1 1.8s infinite ease-in-out"}}),e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot2 1.8s infinite ease-in-out"}}),e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot3 1.8s infinite ease-in-out"}})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes typingDot1 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          30% { transform: scale(1.2); opacity: 1; }
        }
        @keyframes typingDot2 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          45% { transform: scale(1.2); opacity: 1; }
        }
        @keyframes typingDot3 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          60% { transform: scale(1.2); opacity: 1; }
        }
      `})]})},Wt=({isOpen:l,onClose:r,isAuthenticated:s=!1})=>{const[y,m]=c.useState("color"),[a,k]=c.useState({type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null}),[P,C]=c.useState(!1),w=dt();c.useEffect(()=>{l&&_()},[l,s]);const _=async()=>{console.log("loadCurrentSettings called, isAuthenticated:",s);try{let o=null;if(s){console.log("Loading settings from API...");const g=await B.get("/api/user/background-settings");console.log("API response:",g.data),g.data.success?(o=g.data.settings,console.log("Loaded settings from API:",o),k(o)):(console.warn("API returned success=false"),o={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null,imageSize:"cover",imagePosition:"center"},k(o))}else{console.log("Loading settings from cookies...");const g=f("guest_background_settings");if(console.log("Cookie settings:",g),g)try{o=JSON.parse(g),console.log("Parsed cookie settings:",o),k(o)}catch(h){console.warn("Failed to parse guest background settings:",h),o={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null},k(o)}else o={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null},k(o)}console.log("Setting active tab based on settings type:",o?.type),o&&o.type==="image"?(console.log("Setting active tab to image because type is image"),m("image")):(console.log("Setting active tab to color because type is solid/gradient:",o?.type),m("color"))}catch(o){console.error("Error loading background settings:",o),k({type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null}),m("color")}},f=o=>{const h=`; ${document.cookie}`.split(`; ${o}=`);return h.length===2?h.pop().split(";").shift():null},N=(o,g,h)=>{const D=new Date;D.setTime(D.getTime()+h*24*60*60*1e3),document.cookie=`${o}=${g};expires=${D.toUTCString()};path=/`},v=async()=>{console.log("handleSave called with settings:",a),C(!0);try{if(s){const o={type:a.type,color:a.type==="solid"?a.color:null,gradient:a.type==="gradient"?a.gradient:null,image:a.type==="image"?a.image:null,imageSize:a.type==="image"?a.imageSize:null,imagePosition:a.type==="image"?a.imagePosition:null};console.log("Sending save data:",o),console.log("Current settings:",a);const g=await B.post("/api/user/background-settings",o);console.log("Save response:",g.data),console.log("Current settings after save:",a),g.data.success?(w.success("Arxa fon parametrl…ôri saxlanƒ±ldƒ±!"),S(),r()):(console.log("Save failed:",g.data),w.error("X…ôta ba≈ü verdi!"))}else N("guest_background_settings",JSON.stringify(a),70),w.success("Arxa fon parametrl…ôri saxlanƒ±ldƒ±!"),S(),r()}catch(o){console.error("Save error:",o),w.error("Saxlama zamanƒ± x…ôta ba≈ü verdi!")}finally{C(!1)}},S=()=>{console.log("applyBackground called with settings:",a);const o=document.querySelector("#chat-container, [data-chat-background]");if(console.log("Chat container found:",o),o){let g="";switch(a.type){case"solid":g=a.color||"#f3f4f6",console.log("Solid color background style:",g);break;case"gradient":g=a.gradient,console.log("Gradient background style:",g);break;case"image":if(a.image){let h=a.image;!h.startsWith("http")&&!h.startsWith("/")&&(h="/"+h),g=`url(${h})`,o.style.backgroundSize=a.imageSize||"cover",o.style.backgroundPosition=a.imagePosition||"center",o.style.backgroundRepeat="no-repeat",console.log("Applied image background:",{url:h,size:a.imageSize||"cover",position:a.imagePosition||"center"})}else g=a.color||"#f3f4f6";break;default:g="#f3f4f6"}console.log("Applying background style:",g),a.type==="image"?(o.style.setProperty("background-image",g,"important"),o.style.setProperty("background-size",a.imageSize||"cover","important"),o.style.setProperty("background-position",a.imagePosition||"center","important"),o.style.setProperty("background-repeat","no-repeat","important"),o.style.setProperty("background-color","","important")):(o.style.setProperty("background-image","","important"),o.style.setProperty("background-size","","important"),o.style.setProperty("background-position","","important"),o.style.setProperty("background-repeat","","important"),a.type==="gradient"?(o.style.setProperty("background",g,"important"),o.style.setProperty("background-color","","important")):a.type==="solid"?(o.style.setProperty("background","none","important"),o.style.setProperty("background-image","none","important"),o.style.setProperty("background-size","auto","important"),o.style.setProperty("background-position","0% 0%","important"),o.style.setProperty("background-repeat","repeat","important"),o.style.setProperty("background-attachment","scroll","important"),o.style.setProperty("background-origin","padding-box","important"),o.style.setProperty("background-clip","border-box","important"),o.style.setProperty("background-color",g,"important"),console.log("Applied solid color with full reset:",g)):(o.style.setProperty("background-color",g,"important"),o.style.setProperty("background","","important"))),window.dispatchEvent(new CustomEvent("backgroundChanged",{detail:{type:a.type,background:g,imageSize:a.imageSize,imagePosition:a.imagePosition}}))}else console.error("Chat container not found! Available elements:"),console.log("Elements with id chat-container:",document.querySelectorAll("#chat-container")),console.log("Elements with data-chat-background:",document.querySelectorAll("[data-chat-background]")),console.log("All divs on page:",document.querySelectorAll("div").length),console.log("Page body classes:",document.body.className)},A=async()=>{if(console.log("Delete image called, current settings:",a),!a.image){console.log("No image to delete");return}C(!0);try{console.log("Sending delete request to /api/user/background-image");const o=await B.delete("/api/user/background-image");console.log("Delete response:",o.data),o.data.success?(k(g=>({...g,image:null,imageSize:"cover",imagePosition:"center",type:"solid",color:"#f3f4f6"})),m("color"),w.success("≈û…ôkil silindi!")):w.error("≈û…ôkil silin…ôrk…ôn x…ôta ba≈ü verdi!")}catch(o){console.error("Delete error:",o),w.error("≈û…ôkil silin…ôrk…ôn x…ôta ba≈ü verdi!")}finally{C(!1)}},se=async o=>{if(!o)return;if(o.size>400*1024){w.error("≈û…ôkil √∂l√ß√ºs√º 400KB-dan b√∂y√ºk ola bilm…ôz!");return}C(!0);const g=new FormData;g.append("image",o);try{const h=await B.post("/api/user/upload-background-image",g);if(h.data.success){console.log("Upload successful, URL:",h.data.url);const D={...a,image:h.data.url,imageSize:"cover",imagePosition:"center",type:"image"};k(D),w.success("≈û…ôkil y√ºkl…ôndi!")}else console.log("Upload failed:",h.data),w.error("≈û…ôkil y√ºkl…ônm…ôdi!")}catch(h){console.error("Upload error:",h),console.error("Upload error response:",h.response),h.response&&console.error("Upload error data:",h.response.data),w.error("≈û…ôkil y√ºkl…ônm…ô x…ôtasƒ±!")}finally{C(!1)}},ve=[{name:"G√∂y-B…ôn√∂v≈ü…ôyi",value:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{name:"√á…ôhrayƒ±-Narƒ±ncƒ±",value:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{name:"Ya≈üƒ±l-Mavi",value:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{name:"Qƒ±zƒ±l-Narƒ±ncƒ±",value:"linear-gradient(135deg, #ffa751 0%, #ff6b6b 100%)"},{name:"B…ôn√∂v≈ü…ôyi-√á…ôhrayƒ±",value:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"},{name:"T√ºnd Mavi",value:"linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)"}];return l?e.jsx(Z,{children:e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(p.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Arxa Fon Parametrl…ôri"}),e.jsx("button",{onClick:r,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(u,{name:"close",size:20})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>{m("color"),a.type==="image"&&k(o=>({...o,type:"solid"}))},className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${y==="color"?"text-purple-600 border-b-2 border-purple-600 bg-purple-50 dark:bg-purple-900/20":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"R…ông & Gradient"}),e.jsxs("button",{onClick:()=>{m("image"),a.image&&k(o=>({...o,type:"image"}))},disabled:!s,className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${y==="image"&&s?"text-purple-600 border-b-2 border-purple-600 bg-purple-50 dark:bg-purple-900/20":s?"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200":"text-gray-300 dark:text-gray-600 cursor-not-allowed"}`,children:["≈û…ôkil ",!s&&"üîí"]})]}),e.jsxs("div",{className:"p-6",children:[y==="color"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{console.log("Solid color selected");const o={...a,type:"solid"};k(o)},className:`flex-1 p-3 rounded-lg border-2 text-sm font-medium transition-all ${a.type==="solid"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:"Solid R…ông"}),e.jsx("button",{onClick:()=>{console.log("Gradient selected");const o={...a,type:"gradient"};k(o)},className:`flex-1 p-3 rounded-lg border-2 text-sm font-medium transition-all ${a.type==="gradient"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:"Gradient"})]}),a.type==="solid"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"R…ông se√ßin"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"color",value:a.color,onChange:o=>{console.log("Color changed to:",o.target.value);const g={...a,color:o.target.value,type:"solid"};k(g)},className:"w-16 h-12 rounded-lg border-2 border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:a.color,onChange:o=>{console.log("Color text changed to:",o.target.value);const g={...a,color:o.target.value,type:"solid"};k(g)},className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#f3f4f6"})]})]}),a.type==="gradient"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"X√ºsusi Gradient CSS"}),e.jsx("textarea",{value:a.gradient,onChange:o=>{console.log("Gradient changed to:",o.target.value);const g={...a,gradient:o.target.value,type:"gradient"};k(g)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-mono text-sm h-20",placeholder:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Hazƒ±r Gradientl…ôr"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:ve.map((o,g)=>e.jsx("button",{onClick:()=>{const h={...a,gradient:o.value,type:"gradient"};k(h)},className:"text-xs px-3 py-2 border rounded-lg text-left hover:opacity-80 transition-opacity text-white font-medium",style:{background:o.value},children:o.name},g))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"√ñnizl…ôm…ô"}),e.jsx("div",{className:"w-full h-20 rounded-lg border-2 border-gray-200 flex items-center justify-center",style:{background:a.type==="solid"?a.color:a.gradient},children:e.jsx("span",{className:"bg-black/20 px-3 py-1 rounded text-white text-sm font-medium",children:"Arxa Fon N√ºmun…ôsi"})})]})]}),y==="image"&&e.jsx("div",{className:"space-y-4",children:s?e.jsxs(e.Fragment,{children:[a.image?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50 dark:bg-gray-800",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üö´"}),e.jsx("span",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"≈û…ôkil y√ºkl…ônib"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-500",children:"Ba≈üqa ≈ü…ôkil y√ºkl…ôm…ôk √º√ß√ºn m√∂vcud ≈ü…ôkili silin"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üì∑"}),e.jsxs("label",{htmlFor:"background-image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"≈û…ôkil y√ºkl…ôyin"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF (Maksimum 400KB)"}),e.jsx("input",{id:"background-image-upload",type:"file",accept:"image/*",className:"sr-only",onChange:o=>se(o.target.files[0])})]})]}),a.image&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cari ≈û…ôkil"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-full h-40 rounded-lg border-2 border-gray-200 overflow-hidden",style:{backgroundImage:`url(${a.image})`,backgroundSize:a.imageSize||"cover",backgroundPosition:a.imagePosition||"center",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black/10",children:e.jsx("span",{className:"bg-white/90 px-2 py-1 rounded text-xs font-medium text-gray-700",children:"√ñnizl…ôm…ô"})})}),e.jsx("button",{onClick:A,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm hover:bg-red-600 transition-colors",title:"≈û…ôkili sil",children:"√ó"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"≈û…ôkil √ñl√ß√ºs√º"}),e.jsx("div",{className:"flex gap-2",children:["cover","contain","auto","100% 100%"].map(o=>e.jsx("button",{onClick:()=>{const g={...a,imageSize:o};k(g)},className:`px-3 py-1 text-xs rounded-lg border transition-colors ${(a.imageSize||"cover")===o?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300 text-gray-700 dark:text-gray-300"}`,children:o==="cover"?"Doldur":o==="contain"?"Sƒ±ƒüƒ±≈üdƒ±r":o==="auto"?"Orjinal":"Uzat"},o))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"≈û…ôkil M√∂vqeyi"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 max-w-[120px]",children:[["top left","‚ÜñÔ∏è"],["top center","‚¨ÜÔ∏è"],["top right","‚ÜóÔ∏è"],["center left","‚¨ÖÔ∏è"],["center","‚≠ï"],["center right","‚û°Ô∏è"],["bottom left","‚ÜôÔ∏è"],["bottom center","‚¨áÔ∏è"],["bottom right","‚ÜòÔ∏è"]].map(([o,g])=>e.jsx("button",{onClick:()=>{const h={...a,imagePosition:o};k(h)},className:`w-8 h-8 text-xs rounded border flex items-center justify-center transition-colors ${(a.imagePosition||"center")===o?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-600":"border-gray-200 dark:border-gray-600 hover:border-gray-300 text-gray-500"}`,title:o,children:g},o))})]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"D…ôyi≈üiklikl…ôr real-time g√∂st…ôrilir"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîí"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"≈û…ôkil Y√ºkl…ôm…ô Qadaƒüandƒ±r"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"≈û…ôkil y√ºkl…ôm…ôk √º√ß√ºn hesaba daxil olmalƒ±sƒ±nƒ±z"})]})})]}),e.jsxs("div",{className:"flex gap-2 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:r,className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"L…ôƒüv et"}),e.jsx("button",{onClick:async()=>{k({type:"default",color:"transparent",gradient:"",image:null,imageSize:"cover",imagePosition:"center"});const g=document.querySelector("#chat-container, [data-chat-background]");g&&(g.style.removeProperty("background"),g.style.removeProperty("background-image"),g.style.removeProperty("background-size"),g.style.removeProperty("background-position"),g.style.removeProperty("background-repeat"),g.style.removeProperty("background-color"),g.style.removeProperty("background-attachment"),g.style.removeProperty("background-origin"),g.style.removeProperty("background-clip")),window.dispatchEvent(new CustomEvent("backgroundChanged",{detail:{type:"default"}}));try{if(C(!0),console.log("Sending reset request with current settings:",a),s){const h={type:"default",color:null,gradient:null,image:null,imageSize:null,imagePosition:null};console.log("Sending reset data to API:",h);const D=await B.post("/api/user/background-settings",h);console.log("Reset API response:",D.data),D.data.success?(console.log("Reset successful - background and file should be deleted"),w.success("Arxa fon v…ô ≈ü…ôkil sƒ±fƒ±rlandƒ±!")):(console.error("Reset failed:",D.data),w.error("Sƒ±fƒ±rlama uƒüursuz oldu!"))}else document.cookie="guest_background_settings=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",w.success("Qonaq parametrl…ôri sƒ±fƒ±rlandƒ±!");setTimeout(()=>{_()},500),r()}catch(h){console.error("Reset error details:",h),console.error("Error response:",h.response?.data),w.error("Sƒ±fƒ±rlama zamanƒ± x…ôta ba≈ü verdi: "+(h.response?.data?.message||h.message))}finally{C(!1)}},disabled:P,className:"px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 transition-colors text-sm",title:"Defolt r…ông…ô qaytar",children:"Sƒ±fƒ±rlamaq"}),e.jsx("button",{onClick:v,disabled:P,className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 disabled:opacity-50 transition-colors",children:P?"Saxlanƒ±r...":"Yadda Saxla"})]})]})})}):null},Ot=["Z…ôr…ôrli / T…ôhl√ºk…ôli","Saxta","Yararsƒ±z","Dig…ôr"];function Xt({isOpen:l,onClose:r,onSubmit:s,messagePreview:y=""}){const{theme:m}=ie(),[a,k]=c.useState([]),[P,C]=c.useState("");if(c.useEffect(()=>{if(l){k([]),C("");try{document.body.style.overflow="hidden"}catch{}}else try{document.body.style.overflow=""}catch{}return()=>{try{document.body.style.overflow=""}catch{}}},[l]),!l)return null;const w=f=>{k(N=>N.includes(f)?N.filter(v=>v!==f):[...N,f])},_=()=>{const f={tags:a,comment:P?.trim()||""};s&&s(f),r&&r()};return e.jsx(Z,{children:l&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.25},className:"absolute inset-0 bg-black/60 backdrop-blur-md",onClick:r}),e.jsxs(p.div,{initial:{opacity:0,scale:.95,y:12},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:12},transition:{duration:.25,type:"spring",stiffness:260,damping:22},role:"dialog","aria-modal":"true",className:"relative z-50 w-full max-w-lg mx-auto rounded-2xl overflow-hidden shadow-2xl border border-white/20 dark:border-gray-700",style:{background:"#0b0b0b00"},children:[e.jsx("div",{className:"p-5 text-white",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(u,{name:"warning",size:22,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Feedback"}),e.jsx("p",{className:"text-blue-100 text-xs",children:"Geribildiri≈üinizi payla≈üƒ±n"})]})]}),e.jsx("button",{onClick:r,className:"p-1.5 rounded-lg hover:bg-white/20 transition-colors","aria-label":"Baƒüla",children:e.jsx(u,{name:"close",size:18,color:"#fff"})})]})}),e.jsxs("div",{className:"p-5 bg-white dark:bg-gray-800",children:[e.jsx("div",{className:"flex flex-wrap gap-2 mb-3",children:Ot.map(f=>e.jsx("button",{type:"button",onClick:()=>w(f),className:`px-3 py-1.5 rounded-full text-xs font-medium border transition-all ${a.includes(f)?"text-white shadow-md":"text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-700/60"}`,style:a.includes(f)?{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)",borderColor:"transparent"}:{borderColor:"rgba(0,0,0,0.08)"},children:f},f))}),y&&e.jsxs("div",{className:"mb-3 text-xs text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-700/40 p-3 rounded-lg max-h-28 overflow-auto",children:[e.jsx("div",{className:"font-semibold mb-1",children:"Mesaj:"}),e.jsx("div",{className:"whitespace-pre-wrap",children:y})]}),e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200 mb-1 block",children:"≈û…ôrh"}),e.jsx("textarea",{rows:4,value:P,onChange:f=>C(f.target.value),placeholder:"Qƒ±sa izah yazƒ±n...",className:"w-full rounded-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-900/60 text-gray-800 dark:text-gray-100 p-3 focus:outline-none focus:ring-2 focus:ring-emerald-400"})]}),e.jsxs("div",{className:"p-5 flex gap-3 border-t border-gray-200 dark:border-gray-700 bg-gradient-to-r",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color}15 0%, ${m.secondary_color||m.primary_color}15 100%)`:"linear-gradient(135deg, #10b98115 0%, #065f4615 100%)"},children:[e.jsx("button",{type:"button",onClick:r,className:"flex-1 px-4 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-xl font-medium hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"L…ôƒüv et"}),e.jsx("button",{type:"button",onClick:_,className:"flex-1 px-4 py-3 text-white rounded-xl font-medium shadow-lg hover:shadow-xl transition-all",style:{background:m?.primary_color?`linear-gradient(135deg, ${m.primary_color} 0%, ${m.secondary_color||m.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:"G√∂nd…ôr"})]})]})]})})}const Jt=l=>{const s=`; ${document.cookie}`.split(`; ${l}=`);return s.length===2?s.pop().split(";").shift():null},it=l=>{console.log("BackgroundLoader: applyBackgroundFromSettings called",l);const r=document.querySelector("#chat-container, [data-chat-background]");if(console.log("BackgroundLoader: Chat container found:",r),!r){console.error("BackgroundLoader: Chat container not found!");return}let s="";if(!l.type||l.type==="default"){console.log("BackgroundLoader: Clearing all background styles for default theme"),r.style.removeProperty("background"),r.style.removeProperty("background-image"),r.style.removeProperty("background-color"),r.style.removeProperty("background-size"),r.style.removeProperty("background-position"),r.style.removeProperty("background-repeat"),r.style.removeProperty("background-attachment"),r.style.removeProperty("background-origin"),r.style.removeProperty("background-clip");return}switch(l.type){case"solid":s=l.color||"transparent";break;case"gradient":s=l.gradient;break;case"image":if(l.image){let y=l.image;!y.startsWith("http")&&!y.startsWith("/")&&(y="/"+y),s=`url(${y})`,r.style.backgroundSize=l.imageSize||"cover",r.style.backgroundPosition=l.imagePosition||"center",r.style.backgroundRepeat="no-repeat",console.log("BackgroundLoader: Applied image background:",{url:y,size:l.imageSize||"cover",position:l.imagePosition||"center"})}else s=l.color||"#f3f4f6";break;default:console.log("BackgroundLoader: Unknown type, clearing all background styles"),r.style.removeProperty("background"),r.style.removeProperty("background-image"),r.style.removeProperty("background-color"),r.style.removeProperty("background-size"),r.style.removeProperty("background-position"),r.style.removeProperty("background-repeat"),r.style.removeProperty("background-attachment"),r.style.removeProperty("background-origin"),r.style.removeProperty("background-clip");return}console.log("BackgroundLoader: Applying background style:",s),l.type==="image"?(r.style.backgroundImage=s,r.style.backgroundSize=l.imageSize||"cover",r.style.backgroundPosition=l.imagePosition||"center",r.style.backgroundRepeat="no-repeat",r.style.backgroundColor=""):l.type==="gradient"?(r.style.backgroundImage="",r.style.backgroundSize="",r.style.backgroundPosition="",r.style.backgroundRepeat="",r.style.background=s,r.style.backgroundColor=""):l.type==="solid"&&(r.style.setProperty("background","none","important"),r.style.setProperty("background-image","none","important"),r.style.setProperty("background-size","auto","important"),r.style.setProperty("background-position","0% 0%","important"),r.style.setProperty("background-repeat","repeat","important"),r.style.setProperty("background-attachment","scroll","important"),r.style.setProperty("background-origin","padding-box","important"),r.style.setProperty("background-clip","border-box","important"),r.style.setProperty("background-color",s,"important"),console.log("BackgroundLoader: Applied solid color with full reset:",s))},lt=async(l=!1)=>{console.log("BackgroundLoader: loadUserBackground called, isAuthenticated:",l);try{if(l){console.log("BackgroundLoader: Loading from API for authenticated user");const r=await fetch("/api/user/background-settings",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("BackgroundLoader: API response status:",r.status),r.ok){const s=await r.json();console.log("BackgroundLoader: API response data:",s),s.success?it(s.settings):console.warn("BackgroundLoader: API returned success=false")}else console.error("BackgroundLoader: API request failed with status:",r.status)}else{const r=Jt("guest_background_settings");if(r)try{const s=JSON.parse(r);it(s)}catch(s){console.warn("Failed to parse guest background settings:",s)}}}catch(r){console.warn("Failed to load user background:",r)}},Kt=({text:l,speed:r=50,onComplete:s})=>{const[y,m]=c.useState(""),[a,k]=c.useState(0);return c.useEffect(()=>{m(""),k(0)},[l]),c.useEffect(()=>{if(a<l.length){const P=setTimeout(()=>{m(C=>C+l[a]),k(C=>C+1)},r);return()=>clearTimeout(P)}else a===l.length&&a>0&&s&&s()},[a,l,r,s]),e.jsx("span",{children:y})},Yt=({content:l})=>e.jsx(Lt,{remarkPlugins:[Et],rehypePlugins:[At],components:{h1:({node:r,...s})=>e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800 dark:text-gray-100",...s}),h2:({node:r,...s})=>e.jsx("h2",{className:"text-xl font-semibold mb-1 text-gray-800 dark:text-gray-100",...s}),h3:({node:r,...s})=>e.jsx("h3",{className:"text-lg font-medium mb-1 text-gray-700 dark:text-gray-200",...s}),h4:({node:r,...s})=>e.jsx("h4",{className:"text-base font-medium mb-1 text-gray-700 dark:text-gray-200",...s}),p:({node:r,...s})=>e.jsx("p",{className:"mb-1 leading-normal text-gray-800 dark:text-gray-200",...s}),strong:({node:r,...s})=>e.jsx("strong",{className:"font-bold text-gray-900 dark:text-gray-100",...s}),em:({node:r,...s})=>e.jsx("em",{className:"italic text-gray-800 dark:text-gray-200",...s}),ul:({node:r,...s})=>e.jsx("ul",{className:"list-disc list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...s}),ol:({node:r,...s})=>e.jsx("ol",{className:"list-decimal list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...s}),li:({node:r,...s})=>e.jsx("li",{className:"text-gray-800 dark:text-gray-200",...s}),blockquote:({node:r,...s})=>e.jsx("blockquote",{className:"border-l-4 border-emerald-400 pl-4 py-1 mb-1 bg-emerald-50 dark:bg-emerald-900/30 text-gray-700 dark:text-gray-300",...s}),code:({node:r,inline:s,...y})=>s?e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded text-sm font-mono text-gray-800 dark:text-gray-200",...y}):e.jsx("code",{className:"block bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-sm font-mono text-gray-800 dark:text-gray-200 overflow-x-auto",...y}),a:({node:r,...s})=>e.jsx("a",{className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 underline",target:"_blank",rel:"noopener noreferrer",...s})},children:l});function lr({auth:l,sessions:r=[],settings:s={},theme:y={},footerSettings:m={}}){const a=dt(),{theme:k,isDarkMode:P,toggleDarkMode:C,refreshTheme:w}=ie(),_=k||y,f={..._,isDarkMode:P,toggleDarkMode:C},[N,v]=c.useState(null),[S,A]=c.useState([]),[se,ve]=c.useState(""),[o,g]=c.useState(!1),[h,D]=c.useState(!1),[Ue,V]=c.useState(!1),M=c.useRef(!1),I=c.useRef(0),[We,$]=c.useState(""),[we,le]=c.useState([]),[Pe,je]=c.useState(r||[]);c.useEffect(()=>{je(r||[])},[JSON.stringify(r)]);const[de,ct]=c.useState(!0),[gt,Ne]=c.useState(new Set),[E,ee]=c.useState(!1),[q,W]=c.useState(!1);c.useEffect(()=>{console.log("Sidebar state:",q,"Window width:",window.innerWidth)},[q]);const[Oe,Te]=c.useState(null),[te,mt]=c.useState(new Map),[ut,_e]=c.useState(!1),De=c.useRef(null),[Xe,pt]=c.useState({top:0,left:0,align:"left"}),Je=t=>{try{const n=t.getBoundingClientRect(),d=8,i=window.innerWidth,x=n.right+320<i,j=x?Math.max(8,n.left):Math.max(8,n.right-320),b=Math.min(window.innerHeight-200,n.bottom+d);pt({top:b,left:j,align:x?"left":"right"})}catch{}},[Ke,xt]=c.useState(()=>{try{const t=localStorage.getItem("feedbackGiven"),n=t?JSON.parse(t):[];return new Set(n.map(String))}catch{return new Set}}),yt=t=>{try{const n=new Set(Ke);n.add(String(t)),xt(n),localStorage.setItem("feedbackGiven",JSON.stringify([...n]))}catch{}},L=c.useRef(null),ce=c.useRef(null),[ht,Me]=c.useState(!1),[bt,Ie]=c.useState(!1),[U,Y]=c.useState(!0),[ft,$e]=c.useState(!1),[O,Le]=c.useState(null),[X,Se]=c.useState(()=>{const t=Number(localStorage.getItem("messageFontScale"));return t&&t>=.85&&t<=1.4?t:1}),[kt,vt]=c.useState(!1),[Ae,Ce]=c.useState(new Map),[Ye,wt]=c.useState(null),[jt,Ee]=c.useState(!1),[qe,Qe]=c.useState(null),[Nt,Ze]=c.useState(!1);c.useEffect(()=>{try{localStorage.setItem("messageFontScale",String(X))}catch{}},[X]);const _t=async()=>{if(O)try{if(l?.user){const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{await B.delete(`/chat/${O.session_id}`,{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}catch{await B.post(`/chat/${O.session_id}/delete`,{},{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}je(n=>n.filter(d=>d.session_id!==O.session_id)),N===O.session_id&&(v(null),A([]))}else{const n=JSON.parse(localStorage.getItem("guestChatSessions")||"[]").filter(d=>d.session_id!==O.session_id);localStorage.setItem("guestChatSessions",JSON.stringify(n)),le(n),N===O.session_id&&(v(null),A([]))}a.success("S√∂hb…ôt silindi!")}catch(t){console.error("Delete session error:",t),a.error("S√∂hb…ôt silin…ôrk…ôn x…ôta ba≈ü verdi")}finally{$e(!1),Le(null)}},St=()=>{$e(!1),Le(null)},[H,Fe]=c.useState({allowed:!0,remaining:0,daily_remaining:0,monthly_remaining:0,reset_time:null,monthly_reset_time:null,user_type:"guest"}),[ge,Be]=c.useState(!1),[me,He]=c.useState(null),Ve=s.chatbot_name||"AI Assistant",ue=s.site_name||"XIV AI Chatbot Platform",Ct=s.chat_disclaimer_text||"√áatbotun cavablarƒ±nƒ± yoxlayƒ±n, s…ôhv ed…ô bil…ôr!",re=Number(s.message_input_limit||s.guest_input_limit||500),pe=s.ai_response_type||"typewriter",zt=Number(s.ai_typing_speed||50),et=Number(s.ai_thinking_time||1e3),J=!l?.user,xe=se.length,tt=re-xe,Q=re>0&&xe>re,z=_?.primary_color||y?.primary_color||"#17cf1a",K=_?.secondary_color||y?.secondary_color||"#179207";_?.accent_color||y?.accent_color,_?.background_gradient||y?.background_gradient,_?.text_color||y?.text_color;const ze=(()=>{const t=typeof window<"u"?window.innerWidth<768:!1,n=f.isDarkMode,d=s||{},i=d.brand_logo_desktop_light,x=d.brand_logo_desktop_dark,j=d.brand_logo_mobile_light,b=d.brand_logo_mobile_dark;if(t){if(n&&b)return b;if(!n&&j)return j}else{if(n&&x)return x;if(!n&&i)return i}return d.brand_logo_url||""})(),Re=(()=>{const t=_?.chat_background_type;if(!t||t==="default"||t===null)return"transparent";switch(t){case"solid":return _?.chat_background_color||"transparent";case"gradient":return _?.chat_background_gradient||"transparent";case"image":return _?.chat_background_image?`url(${_.chat_background_image})`:"transparent";default:return"transparent"}})(),rt=t=>{if(!t)return"";const d=t-new Date;if(d<=0)return"Yenil…ônir...";const i=Math.floor(d/(1e3*60*60)),x=Math.floor(d%(1e3*60*60)/(1e3*60)),j=Math.floor(d%(1e3*60)/1e3);return i>0?`${i} saat ${x} d…ôqiq…ô ${j} saniy…ô`:x>0?`${x} d…ôqiq…ô ${j} saniy…ô`:`${j} saniy…ô`},ye=async()=>{try{const n=await(await fetch(`/api/chat-limits?t=${Date.now()}`,{cache:"no-store"})).json();Fe(n),n.allowed?(Be(!1),(bt||l?.user)&&Y(!1)):(Be(!0),Y(!0),n.reset_time&&He(new Date(n.reset_time)))}catch(t){console.error("Failed to fetch limits:",t)}};c.useEffect(()=>{if(l?.user)Y(!1),Ie(!0);else{const t=JSON.parse(localStorage.getItem("guestChatSessions")||"[]");le(t),localStorage.getItem("guest-terms-accepted")==="true"?(Ie(!0),Y(!1)):(Me(!0),Y(!0))}ye()},[l?.user]),c.useEffect(()=>{ye();const t=setInterval(ye,3e4),n=setInterval(()=>{me&&me-new Date<=0&&(ye(),He(null))},1e3);return()=>{clearInterval(t),clearInterval(n)}},[me]),c.useEffect(()=>{const t=()=>{w&&w(),ye()};return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[w]),c.useEffect(()=>{const t=setTimeout(()=>{lt(!!l?.user)},200),n=d=>{const i=document.querySelector("#chat-container, [data-chat-background]");if(i){if(!d.detail||!d.detail.type||d.detail.type==="default"){console.log("Chat listener: Clearing all background styles for default"),i.style.removeProperty("background"),i.style.removeProperty("background-image"),i.style.removeProperty("background-color"),i.style.removeProperty("background-size"),i.style.removeProperty("background-position"),i.style.removeProperty("background-repeat"),i.style.removeProperty("background-attachment"),i.style.removeProperty("background-origin"),i.style.removeProperty("background-clip");return}d.detail.background&&(d.detail.type==="image"?(i.style.backgroundImage=d.detail.background,i.style.backgroundSize=d.detail.imageSize||"cover",i.style.backgroundPosition=d.detail.imagePosition||"center",i.style.backgroundRepeat="no-repeat",i.style.backgroundColor=""):d.detail.type==="gradient"?(i.style.backgroundImage="",i.style.backgroundSize="",i.style.backgroundPosition="",i.style.backgroundRepeat="",i.style.background=d.detail.background,i.style.backgroundColor=""):d.detail.type==="solid"&&(i.style.setProperty("background","none","important"),i.style.setProperty("background-image","none","important"),i.style.setProperty("background-size","auto","important"),i.style.setProperty("background-position","0% 0%","important"),i.style.setProperty("background-repeat","repeat","important"),i.style.setProperty("background-attachment","scroll","important"),i.style.setProperty("background-origin","padding-box","important"),i.style.setProperty("background-clip","border-box","important"),i.style.setProperty("background-color",d.detail.background,"important"),console.log("Chat listener applied solid color:",d.detail.background))),setTimeout(()=>lt(!!l?.user),200)}};return window.addEventListener("backgroundChanged",n),()=>{clearTimeout(t),window.removeEventListener("backgroundChanged",n)}},[l?.user]);const at=(t,n,d)=>{if(!l?.user){const i={session_id:t,title:n||t.slice(0,8),messages:d||[],created_at:new Date().toISOString()},x=JSON.parse(localStorage.getItem("guestChatSessions")||"[]"),j=x.findIndex(R=>R.session_id===t);j>=0?x[j]={...x[j],messages:d}:x.unshift(i);const b=x.slice(0,10);localStorage.setItem("guestChatSessions",JSON.stringify(b)),le(b)}},Pt=async t=>{if(l?.user)try{const{data:n}=await B.get(`/chat/${t}`);A(n.messages)}catch(n){a.error("S√∂hb…ôt y√ºkl…ônm…ôdi"),console.error("loadSession error:",n)}else{const n=we.find(d=>d.session_id===t);n&&A(n.messages||[])}v(t)},Tt=()=>{localStorage.setItem("guest-terms-accepted","true"),Ie(!0),ge||Y(!1),Me(!1),a.success("ƒ∞stifad…ô ≈ü…ôrtl…ôri q…ôbul edildi! ƒ∞ndi √ßatbotla danƒ±≈üa bil…ôrsiniz.")},Dt=()=>{Me(!1),Y(!0),a.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn √ßatbotla danƒ±≈üa bilm…ôzsiniz.")},st=async()=>{if(!se.trim())return;if(E){a.warning("√áatbot h…ôl…ô d…ô yazƒ±r. Z…ôhm…ôt olmasa g√∂zl…ôyin.");return}if(U){a.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn mesaj g√∂nd…ôr…ô bilm…ôzsiniz.");return}if(Q){a.warning(`Daxiletm…ô limiti: ${re}. Cari: ${xe} simvol`);return}const t={role:"user",content:se,created_at:new Date().toISOString()};A(i=>[...i,{...t,id:`local-${Date.now()}`}]),ve("");try{ce.current&&(ce.current.style.height="")}catch{}g(!0),D(!0),V(!0),M.current=!0,$("Sual g√∂nd…ôrildi...");const n=++I.current;try{clearTimeout(window.__ragPhaseTimer1),clearTimeout(window.__ragPhaseTimer2),clearTimeout(window.__ragPhaseTimer3),clearTimeout(window.__ragPhaseTimer4)}catch{}window.__ragPhaseTimer1=setTimeout(()=>{I.current===n&&M.current&&$("Embeddings hazƒ±rlanƒ±r...")},300),window.__ragPhaseTimer2=setTimeout(()=>{I.current===n&&M.current&&$("Vektor maƒüazasƒ±nda axtarƒ±≈ü...")},900),window.__ragPhaseTimer3=setTimeout(()=>{I.current===n&&M.current&&$("Kontekst toplanƒ±r...")},1500),window.__ragPhaseTimer4=setTimeout(()=>{I.current===n&&M.current&&$("Cavab formala≈üdƒ±rƒ±lƒ±r...")},2100);const d=new AbortController;Te(d);try{const i=[...S].reverse().find(T=>T.role==="assistant"&&T.ragMeta?.dominant_kb_id!=null),x=(()=>{const T=(t.content||"").trim().toLowerCase();return T.length<=60&&["≈ü…ôrt","≈ü…ôrtl…ôr","qayd","nec…ô","nec…ôdir","n…ôdir","davam","daha","izah","addƒ±m"].some(ae=>T.includes(ae))})(),j=i&&x?i.ragMeta.dominant_kb_id:void 0,{data:b}=await B.post("/chat/send",{message:t.content,session_id:N,...j?{context_kb_id:j}:{}},{signal:d.signal});if(!N){v(b.session_id);const T=t.content.slice(0,40),he=new Date().toISOString();if(l?.user){je(be=>[{session_id:b.session_id,title:"",created_at:he},...be]);let ne=0;const ae=setInterval(()=>{ne++;const be=T.slice(0,ne);je(fe=>fe.map(ke=>ke.session_id===b.session_id?{...ke,title:be}:ke)),ne>=T.length&&clearInterval(ae)},Math.max(20,Math.min(80,1e3/Math.max(5,T.length))))}else{const ne={session_id:b.session_id,title:"",created_at:he,messages:[t]};le(fe=>[ne,...fe]);let ae=0;const be=setInterval(()=>{ae++;const fe=T.slice(0,ae);le(ke=>ke.map(Ge=>Ge.session_id===b.session_id?{...Ge,title:fe}:Ge)),ae>=T.length&&clearInterval(be)},Math.max(20,Math.min(80,1e3/Math.max(5,T.length))))}}const R=`ai-${Date.now()}`;let F;if(pe==="instant"){V(!1),M.current=!1,D(!1),$(""),I.current++,F={role:"assistant",content:b.message,fullContent:b.message,id:R,created_at:new Date().toISOString(),isTyping:!1,ragMeta:b.rag?.metadata||null,isContinuation:!!b.continuation};const T=[...S,t,F];A(he=>[...he,F])}else V(!1),M.current=!1,D(!1),$(""),I.current++,F={role:"assistant",content:"",fullContent:b.message,id:R,created_at:new Date().toISOString(),isTyping:!0,ragMeta:b.rag?.metadata||null,isContinuation:!!b.continuation},A(T=>[...T,F]),ee(!0),setTimeout(()=>{Ne(T=>new Set([...T,R]))},et);const oe=[...S,t,F];if(!l?.user){const T=N||b.session_id;at(T,t.content,oe)}b.limit_info&&Fe({allowed:b.limit_info.remaining>0,remaining:b.limit_info.remaining,daily_remaining:b.limit_info.daily_remaining,monthly_remaining:b.limit_info.monthly_remaining,reset_time:b.limit_info.reset_time,monthly_reset_time:b.limit_info.monthly_reset_time,user_type:l?.user?"user":"guest"})}catch(i){if(i.name==="CanceledError")a.info("Mesaj g√∂nd…ôrm…ô dayandƒ±rƒ±ldƒ±");else if(i.response?.status===429){const x=i.response.data;a.error(x.error||"Mesaj limiti dolmu≈üdur!"),x.limit_exceeded&&(Be(!0),Y(!0),x.reset_time&&He(new Date(x.reset_time)),Fe({allowed:!1,remaining:x.remaining||0,daily_remaining:x.daily_remaining||0,monthly_remaining:x.monthly_remaining||0,reset_time:x.reset_time,monthly_reset_time:x.monthly_reset_time,user_type:l?.user?"user":"guest"}))}else a.error(i.response?.data?.error||"X…ôta ba≈ü verdi");ee(!1)}finally{g(!1),Te(null),setTimeout(()=>{D(!1),V(!1),M.current=!1,I.current++,pe==="instant"&&ee(!1)},600),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50)}},Mt=t=>{const n=S.findIndex(d=>(d.id||"")===(t.id||""));for(let d=n-1;d>=0;d--)if(S[d]?.role==="user"&&typeof S[d].content=="string")return S[d].content;for(let d=S.length-1;d>=0;d--)if(S[d]?.role==="user")return S[d].content;return"Davam et"},It=async t=>{if(!t?.ragMeta?.dominant_kb_id)return;if(E){a.warning("√áatbot h…ôl…ô d…ô yazƒ±r. Z…ôhm…ôt olmasa g√∂zl…ôyin.");return}const n=t.ragMeta.dominant_kb_id,d=t.ragMeta.max_used_chunk_index_for_dominant??-1,i=Mt(t);g(!0),D(!0),V(!0),M.current=!0,$("Davamƒ± hazƒ±rlanƒ±r...");const x=++I.current;try{clearTimeout(window.__ragPhaseTimer1),clearTimeout(window.__ragPhaseTimer2),clearTimeout(window.__ragPhaseTimer3),clearTimeout(window.__ragPhaseTimer4)}catch{}window.__ragPhaseTimer1=setTimeout(()=>{I.current===x&&M.current&&$("Embeddings hazƒ±rlanƒ±r...")},300),window.__ragPhaseTimer2=setTimeout(()=>{I.current===x&&M.current&&$("Vektor maƒüazasƒ±nda axtarƒ±≈ü...")},900),window.__ragPhaseTimer3=setTimeout(()=>{I.current===x&&M.current&&$("Kontekst toplanƒ±r...")},1500),window.__ragPhaseTimer4=setTimeout(()=>{I.current===x&&M.current&&$("Cavab formala≈üdƒ±rƒ±lƒ±r...")},2100);try{const{data:j}=await B.post("/chat/send",{message:i,session_id:N,continue:!0,kb_id:n,start_after_index:d}),b=`ai-${Date.now()}`;V(!1),M.current=!1,D(!1),$(""),I.current++;const R={role:"assistant",content:"",fullContent:j.message,id:b,created_at:new Date().toISOString(),isTyping:pe!=="instant",ragMeta:j.rag?.metadata||null,isContinuation:!0};A(F=>[...F,R]),pe==="instant"?(A(F=>F.map(oe=>oe.id===b?{...oe,content:oe.fullContent,isTyping:!1}:oe)),$("Cavab hazƒ±rlandƒ±.")):(ee(!0),setTimeout(()=>{Ne(F=>new Set([...F,b])),$("Cavab yazƒ±lƒ±r...")},et))}catch(j){a.error(j.response?.data?.error||"X…ôta ba≈ü verdi")}finally{g(!1),setTimeout(()=>{D(!1),V(!1),M.current=!1,I.current++,pe==="instant"&&ee(!1)},600),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50)}},ot=async()=>{Oe&&(Oe.abort(),Te(null));try{await B.post("/chat/stop")}catch{}g(!1),D(!1),ee(!1),Ne(new Set),a.info("Cavab yazmaq dayandƒ±rƒ±ldƒ±")},nt=async(t,n,d)=>{yt(t);try{mt(x=>{const j=new Map(x);return j.set(t,d),j}),await B.post("/chat/feedback",{message_id:t,session_id:N,message_content:n,feedback_type:d});const i=d==="like"?"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, bu bizi sevindirir. :)":"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, biz √ßatbotu t…ôkmil…ô≈üdir…ôc…ôyik, z…ôif t…ôcr√ºb…ômiz √º√ß√ºn √ºzr ist…ôyirik.";a.success(i)}catch(i){console.error("Feedback error:",i);const x=i?.response?.data?.error||"B…ôy…ôn/B…ôy…ônm…ô g√∂nd…ôrilm…ôdi";a.error(x)}},$t=t=>{t.key==="Enter"&&de&&!t.shiftKey&&(t.preventDefault(),o||E?ot():!U&&!E&&st())};return c.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[S]),c.useEffect(()=>{L.current&&L.current.scrollTo({top:L.current.scrollHeight,behavior:"smooth"})},[S]),c.useEffect(()=>{if(L.current&&E){const t=setInterval(()=>{try{const n=L.current;n.scrollTop=n.scrollHeight}catch{}},150);return()=>clearInterval(t)}},[E,S]),c.useEffect(()=>{const t=n=>{De.current&&!De.current.contains(n.target)&&_e(!1)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),c.useEffect(()=>{const t=n=>{n.key==="Escape"&&q&&W(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[q]),c.useEffect(()=>(q&&window.innerWidth<768?(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"):(document.body.style.overflow="",document.body.style.paddingRight=""),()=>{document.body.style.overflow="",document.body.style.paddingRight=""}),[q]),c.useEffect(()=>{const t=()=>{window.innerWidth>=768&&q&&(console.log("Desktop-a ke√ßildi, sidebar baƒülanƒ±r"),W(!1))};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[q]),e.jsx("div",{className:`${f.isDarkMode?"dark":""}`,children:e.jsxs("div",{className:"min-h-screen flex flex-col overflow-x-hidden",style:{background:f.isDarkMode?_?.dark_background_gradient||"linear-gradient(135deg, #1f2937 0%, #111827 100%)":_?.background_gradient||"linear-gradient(135deg, #f9fafb 0%, #ffffff 100%)",backgroundAttachment:"fixed",minHeight:"100dvh"},children:[e.jsx(qt,{title:`∆èsas s…ôhif…ô - ${ue}`}),e.jsxs("div",{className:"w-full px-4 md:px-4 lg:px-6 py-4 md:py-4 lg:py-6 flex-1 flex flex-col min-h-0 pb-24",children:[e.jsxs(p.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"mb-4 md:mb-6 flex flex-wrap items-center justify-between bg-gradient-to-r from-white/80 via-white/85 to-white/80 dark:from-gray-800/80 dark:via-gray-800/85 dark:to-gray-800/80 backdrop-blur-2xl rounded-3xl p-4 md:p-6 shadow-2xl shadow-purple-500/10 dark:shadow-purple-500/20 w-full border border-white/30 dark:border-gray-700/50 hover:shadow-3xl transition-all duration-300",children:[e.jsxs(p.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},className:"flex items-start md:items-center gap-3",children:[e.jsx(p.button,{whileHover:{scale:1.05,rotate:5},whileTap:{scale:.95},onClick:t=>{t.preventDefault(),t.stopPropagation(),console.log("Toggle button clicked:",!q),W(!q)},onTouchStart:t=>{t.preventDefault(),t.stopPropagation(),console.log("Toggle touch start")},onTouchEnd:t=>{t.preventDefault(),t.stopPropagation();const n=!q;console.log("Toggle touch end, changing state from",q,"to",n),W(n)},className:"md:hidden p-3 rounded-xl bg-gradient-to-br from-purple-500/10 to-indigo-500/10 text-gray-700 dark:text-gray-300 hover:from-purple-500/20 hover:to-indigo-500/20 border border-purple-200/30 dark:border-purple-700/30 backdrop-blur-sm transition-all duration-300 shadow-lg hover:shadow-xl","aria-label":"S√∂hb…ôt tarix√ß…ôsi",type:"button",style:{touchAction:"manipulation",WebkitTouchCallout:"none",WebkitUserSelect:"none"},children:e.jsx(u,{name:"menu",size:20})}),e.jsxs(p.h1,{initial:{opacity:0,x:-15},animate:{opacity:1,x:0},transition:{duration:.6,delay:.3},className:"hidden md:flex text-lg md:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent items-center gap-3 hover:from-purple-600 hover:via-indigo-600 hover:to-purple-600 transition-all duration-500",children:[s.brand_mode==="logo"&&(ze||s.brand_logo_url)?e.jsx(p.img,{whileHover:{scale:1.1,rotate:5},src:ze||s.brand_logo_url,alt:"logo",className:"w-8 h-8 md:w-10 md:h-10 object-contain rounded-xl shadow-lg border border-white/20 dark:border-gray-700/50"}):s.brand_mode==="icon"?e.jsx(p.div,{whileHover:{scale:1.1,rotate:5},className:"p-2 rounded-xl bg-gradient-to-br from-purple-500/10 to-indigo-500/10 border border-purple-200/30 dark:border-purple-700/30 shadow-lg",children:e.jsx(u,{name:s.brand_icon_name||"nav_chat",size:28,color:z})}):null,e.jsx(p.span,{whileHover:{scale:1.02},className:"truncate font-extrabold tracking-wide",children:ue})]}),e.jsxs("div",{className:"md:hidden flex flex-col gap-1 ml-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[12px] font-medium text-gray-700 dark:text-gray-300",ref:De,children:[e.jsx(u,{name:"limit",size:18}),e.jsxs("span",{children:[H.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz"]}),e.jsx("span",{className:"text-white px-2 py-0.5 rounded-full",style:{backgroundColor:z},children:H.remaining})," sorƒüu",e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),Je(t.currentTarget),_e(n=>!n)},className:"ml-1 p-1 rounded-md text-gray-800 hover:text-black hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-110",title:"Limit haqqƒ±nda",children:e.jsx(u,{name:"limit_info",size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{name:"sun",size:16,color:f.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.isDarkMode,onChange:()=>f.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(u,{name:"moon",size:16,color:f.isDarkMode?"#60a5fa":"#9ca3af"})]})]})]}),e.jsxs(p.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.4},className:"hidden md:flex items-center gap-3 flex-wrap justify-end",children:[e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative px-4 py-2 rounded-xl text-xs font-semibold backdrop-blur-sm border shadow-lg transition-all duration-300 ${ge?"bg-gradient-to-r from-red-50 to-red-100 text-red-800 border-red-200 shadow-red-200/50":H.remaining<=5?"bg-gradient-to-r from-yellow-50 to-yellow-100 text-yellow-800 border-yellow-200 shadow-yellow-200/50":"bg-gradient-to-r from-green-50 to-green-100 text-green-800 border-green-200 shadow-green-200/50"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{name:ge?"warning":"limit",size:12}),e.jsx("span",{children:ge?e.jsxs(e.Fragment,{children:["M…ôhdudiyy…ôt! - ",rt(me)]}):e.jsxs(e.Fragment,{children:[H.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz ",H.remaining," sorƒüu(√ßƒ±xƒ±≈ü)"]})}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),Je(t.currentTarget),_e(n=>!n)},className:"ml-1 p-1 rounded-md text-gray-800 hover:text-black hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-110",title:"Limit haqqƒ±nda",children:e.jsx(u,{name:"limit_info",size:18})})]})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(u,{name:"sun",size:16,color:f.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:f.isDarkMode,onChange:()=>f.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(u,{name:"moon",size:16,color:f.isDarkMode?"#60a5fa":"#9ca3af"})]}),l?.user?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"hidden md:inline text-sm text-gray-600 dark:text-gray-300",children:["Salam, ",l.user.name]}),l.user.role?.name==="admin"&&e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(G,{href:"/admin",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(u,{name:"settings",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Admin Panel"})]})}),e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(G,{href:"/profile",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 hover:from-gray-200 hover:to-gray-300 dark:from-gray-600 dark:to-gray-700 dark:text-gray-200 dark:hover:from-gray-500 dark:hover:to-gray-600 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(u,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Profil"})]})}),e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(G,{href:"/logout",method:"post",as:"button",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(u,{name:"logout",size:16}),e.jsx("span",{className:"hidden md:inline",children:"√áƒ±xƒ±≈ü"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(G,{href:"/login",className:"px-4 py-2.5 rounded-xl text-sm bg-white/80 backdrop-blur-sm border-2 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-300 dark:bg-gray-800/80 dark:text-emerald-400 dark:hover:bg-gray-700 dark:border-gray-600 dark:hover:border-emerald-500 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",style:{borderColor:z},children:[e.jsx(u,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Daxil ol"})]})}),e.jsx(p.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(G,{href:"/register",className:"px-4 py-2.5 rounded-xl text-sm text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 bg-gradient-to-r hover:scale-105",style:{background:`linear-gradient(135deg, ${z}DD, ${K}DD)`},children:[e.jsx(u,{name:"user_add",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Qeydiyyat"})]})})]}),e.jsxs(p.button,{whileHover:{scale:1.05,rotate:2},whileTap:{scale:.95},onClick:()=>{v(null),A([])},className:"px-4 py-2.5 rounded-xl text-sm text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 bg-gradient-to-r hover:brightness-110",style:{background:`linear-gradient(135deg, ${K}DD, ${z}DD)`},children:[e.jsx(u,{name:"edit",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Yeni s√∂hb…ôt"})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2 ml-auto overflow-x-auto",children:[l?.user?e.jsxs(e.Fragment,{children:[l.user.role?.name==="admin"&&e.jsx(G,{href:"/admin",className:"px-2 py-2 rounded-lg text-sm bg-purple-600 text-white hover:bg-purple-700 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(u,{name:"settings",size:16})}),e.jsx(G,{href:"/profile",className:"px-2 py-2 rounded-lg text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(u,{name:"users",size:16})}),e.jsx(G,{href:"/logout",method:"post",as:"button",className:"px-2 py-2 rounded-lg text-sm bg-red-500 text-white hover:bg-red-600 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(u,{name:"logout",size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{href:"/login",className:"px-2 py-2 rounded-lg text-sm bg-white border text-emerald-700 hover:bg-emerald-50 dark:bg-gray-800 dark:text-emerald-400 dark:hover:bg-gray-700 transition-colors shadow-sm flex items-center gap-1",style:{borderColor:z},children:e.jsx(u,{name:"users",size:16})}),e.jsx(G,{href:"/register",className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:z},children:e.jsx(u,{name:"user_add",size:16})})]}),e.jsx("button",{onClick:()=>{v(null),A([])},className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:K},title:"Yeni s√∂hb…ôt",children:e.jsx(u,{name:"edit",size:16})})]})]}),e.jsxs("div",{className:"flex gap-0 md:gap-4 h-full",children:[e.jsx(Z,{children:q&&e.jsx(p.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden",onTouchStart:t=>{t.preventDefault(),W(!1)},onClick:()=>W(!1)})}),e.jsx(Z,{children:(q||window.innerWidth>=768)&&e.jsxs(p.aside,{initial:{x:window.innerWidth<768?-320:0,opacity:window.innerWidth<768?0:1},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",stiffness:400,damping:25,mass:.6,duration:.4},className:`
                  fixed md:relative
                  top-0 left-0
                  h-full
                  w-80 md:w-72 lg:w-80
                  bg-gradient-to-b from-white/85 via-white/90 to-gray-50/85 dark:from-gray-800/85 dark:via-gray-800/90 dark:to-gray-900/85
                  backdrop-blur-2xl
                  border-r border-gray-200/50 dark:border-gray-700/50
                  rounded-r-3xl md:rounded-3xl
                  z-50 md:z-auto
                  flex flex-col
                  shadow-2xl md:shadow-xl
                `,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(p.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.15,duration:1,type:"spring",stiffness:200,damping:20},className:"md:hidden p-4 bg-gradient-to-r from-indigo-50/50 to-purple-50/50 dark:from-indigo-900/20 dark:to-purple-900/20 border-b border-gray-100 dark:border-gray-700/50 rounded-tr-3xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.brand_mode==="logo"&&(ze||s.brand_logo_url)?e.jsx(p.img,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,duration:.8,type:"spring",stiffness:200},whileHover:{scale:1.1,rotate:5,transition:{duration:.2}},whileTap:{scale:.95},src:ze||s.brand_logo_url,alt:"logo",className:"w-7 h-7 object-contain rounded-lg shadow-md border border-white/30 dark:border-gray-600/50"}):s.brand_mode==="icon"?e.jsx(p.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,duration:.8,type:"spring",stiffness:200},whileHover:{scale:1.1,rotate:5,transition:{duration:.2}},whileTap:{scale:.95},className:"p-1.5 rounded-lg bg-gradient-to-br from-purple-500/15 to-indigo-500/15 border border-purple-200/40 dark:border-purple-700/40 shadow-md",children:e.jsx(u,{name:s.brand_icon_name||"nav_chat",size:20,color:z})}):null,e.jsx(p.span,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{delay:.5,duration:.8,type:"spring",stiffness:150},whileHover:{scale:1.02,x:2,transition:{duration:.2}},className:"font-bold text-lg bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent truncate leading-tight",children:ue})]})}),e.jsxs(p.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gradient-to-r from-purple-50/30 to-indigo-50/30 dark:from-purple-900/10 dark:to-indigo-900/10 md:rounded-t-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p.div,{whileHover:{scale:1.1,rotate:5},children:e.jsx(u,{name:"chat_history",size:24,color:z})}),e.jsx("h2",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider",children:"S√∂hb…ôt Tarix√ß…ôsi"})]}),e.jsx(p.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onTouchStart:t=>{t.preventDefault(),t.stopPropagation(),W(!1)},onClick:t=>{t.preventDefault(),t.stopPropagation(),W(!1)},className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors active:bg-gray-200 dark:active:bg-gray-600 shadow-sm",type:"button","aria-label":"Baƒüla",children:e.jsx(u,{name:"close",size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar",children:[(l?.user?Pe:we).map((t,n)=>e.jsx(p.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:n*.05,duration:.3},whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>{Pt(t.session_id),window.innerWidth<768&&W(!1)},className:`
                        group w-full text-left px-3 py-2.5 rounded-xl transition-all
                        ${N===t.session_id?"bg-gradient-to-r from-emerald-50 to-emerald-100/50 dark:from-gray-700 dark:to-gray-600 border-l-4 shadow-md":"hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:shadow-sm"}
                      `,style:N===t.session_id?{borderLeftColor:z}:{},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.title||t.session_id.slice(0,8)}),t.created_at&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:new Date(t.created_at).toLocaleDateString("az")})]}),e.jsx(p.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:d=>{d.stopPropagation(),Le(t),$e(!0)},className:"opacity-0 group-hover:opacity-100 p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-all",title:"S√∂hb…ôti sil",children:e.jsx(u,{name:"close",size:16,className:"text-red-500"})})]})},t.session_id)),(l?.user?Pe:we).length===0&&e.jsxs(p.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},className:"text-center py-12",children:[e.jsx(u,{name:"chat",size:48,color:f.isDarkMode?"#6b7280":"#d1d5db",className:"mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"He√ß bir s√∂hb…ôt yoxdur"})]})]}),e.jsx(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50/30 to-indigo-50/30 dark:from-purple-900/10 dark:to-indigo-900/10 rounded-br-3xl md:rounded-b-3xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(u,{name:"chat",size:18,color:z}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"√úmumi s√∂hb…ôtl…ôr"})]}),e.jsx(p.div,{whileHover:{scale:1.15},className:"flex items-center justify-center min-w-[28px] h-7 px-2.5 rounded-full text-xs font-bold text-white shadow-lg",style:{backgroundColor:z},children:(l?.user?Pe:we).length})]})})]})}),e.jsx("div",{className:"flex-1 min-w-0 w-full",children:e.jsx("main",{className:"w-full max-w-none",children:e.jsxs("div",{className:`w-full backdrop-blur-xl border border-emerald-200 dark:border-gray-600 rounded-3xl p-3 md:p-6 flex flex-col shadow-2xl hover:shadow-3xl dark:shadow-purple-500/10 border-white/20 dark:border-gray-700/30 transition-all duration-300 relative ${Re==="transparent"?"!bg-white dark:!bg-gray-800":""}`,"data-chat-background":"true",id:"chat-container",style:Re!=="transparent"?{minHeight:"calc(100vh - 200px)",background:Re,backgroundSize:_?.chat_background_type==="image"?"cover":void 0,backgroundPosition:_?.chat_background_type==="image"?"center":void 0,backgroundRepeat:_?.chat_background_type==="image"?"no-repeat":void 0}:{minHeight:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20",children:[e.jsx("button",{onClick:()=>vt(t=>!t),className:"p-2 rounded-lg bg-white/80 dark:bg-gray-700/80 border border-gray-200 dark:border-gray-600 shadow hover:shadow-md transition",title:"M…ôtn √∂l√ß√ºs√º",children:e.jsx(u,{name:"type",size:16})}),kt&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"M…ôtn √∂l√ß√ºs√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:X,onChange:t=>Se(parseFloat(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>Se(.95),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>Se(1),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A"}),e.jsx("button",{onClick:()=>Se(1.2),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsxs("div",{ref:L,className:"flex-1 overflow-y-auto space-y-3 pr-1 md:pr-2 custom-scrollbar",style:{maxHeight:"calc(100vh - 240px)"},children:[e.jsx(Z,{children:S.map((t,n)=>e.jsxs(p.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:`group relative max-w-[90%] md:max-w-[85%] rounded-xl px-3 md:px-4 py-2 md:py-3 ${t.role==="user"?"ml-auto bg-emerald-50/60 dark:bg-emerald-900/20":"mr-auto bg-gray-100/60 dark:bg-gray-700/50"} shadow-lg hover:shadow-xl dark:shadow-2xl dark:hover:shadow-3xl border border-emerald-100 dark:border-gray-600 backdrop-blur-md transition-all duration-300 hover:-translate-y-0.5`,style:{},children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.role==="user"?e.jsx("div",{className:"flex items-center gap-2",children:l?.user?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:z},children:l.user.name}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:z},children:"Siz - Qonaq"})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:K},children:Ve||"AI Assistant"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",title:"AI Aktiv"})]})}),t.created_at&&e.jsxs("div",{className:"text-xs text-gray-400 flex flex-col items-end",children:[e.jsx("span",{className:"hidden md:block",children:new Date(t.created_at).toLocaleDateString("az-AZ",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx("span",{children:new Date(t.created_at).toLocaleTimeString("az-AZ",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"absolute top-1.5 right-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>wt(Ye===(t.id||n)?null:t.id||n),className:"p-1.5 rounded-full bg-white/90 dark:bg-gray-800/90 border border-gray-200 dark:border-gray-600 shadow",title:"Mesaj m…ôtni √∂l√ß√ºs√º",children:e.jsx(u,{name:"type",size:12})}),Ye===(t.id||n)&&e.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3 z-10",children:[e.jsx("div",{className:"text-[11px] font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bu mesaj √º√ß√ºn √∂l√ß√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:Ae.get(t.id)??X,onChange:d=>{const i=parseFloat(d.target.value);Ce(x=>{const j=new Map(x);return j.set(t.id,i),j})},className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>Ce(d=>{const i=new Map(d);return i.set(t.id,Math.max(.85,(i.get(t.id)??X)-.05)),i}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>Ce(d=>{const i=new Map(d);return i.set(t.id,X),i}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Sƒ±fƒ±rla"}),e.jsx("button",{onClick:()=>Ce(d=>{const i=new Map(d);return i.set(t.id,Math.min(1.4,(i.get(t.id)??X)+.05)),i}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-gray-800 dark:text-gray-200",style:{fontSize:`${Ae.get(t.id)??X}rem`},children:t.role==="assistant"?gt.has(t.id)?e.jsx(Kt,{text:t.fullContent,speed:zt,onComplete:()=>{A(d=>{const i=d.map(x=>x.id===t.id?{...x,content:t.fullContent,isTyping:!1}:x);return!l?.user&&N&&setTimeout(()=>{at(N,null,i)},100),i}),Ne(d=>{const i=new Set(d);return i.delete(t.id),i}),ee(!1)}}):e.jsx(Yt,{content:t.content||""}):e.jsx("div",{className:"whitespace-pre-wrap",style:{fontSize:`${Ae.get(t.id)??X}rem`},children:t.content})}),t.role==="assistant"&&!t.isTyping&&e.jsxs("div",{className:"flex items-center justify-start md:justify-between mt-2 flex-wrap gap-1 md:gap-2",children:[(()=>{const d=String(t.id||"");return!(Ke.has(d)||te.has(t.id))})()&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>nt(String(t.id||""),t.content||t.fullContent,"like"),disabled:te.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${te.get(t.id)==="like"?"text-green-600 bg-green-50 dark:bg-green-900/30":"text-gray-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/30"} disabled:opacity-50`,title:"B…ôy…ôn",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{name:"heart",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:te.get(t.id)==="like"?"B…ôy…ôndiniz":"B…ôy…ôn"})]})}),e.jsx("button",{onClick:()=>nt(String(t.id||""),t.content||t.fullContent,"dislike"),disabled:te.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${te.get(t.id)==="dislike"?"text-red-600 bg-red-50 dark:bg-red-900/30":"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30"} disabled:opacity-50`,title:"B…ôy…ônm…ô",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{name:"dislike",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:te.get(t.id)==="dislike"?"B…ôy…ônm…ôdiniz":"B…ôy…ônm…ô"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-75 hover:opacity-100 transition-opacity",children:[t.ragMeta?.dominant_kb_id!=null&&e.jsx("button",{onClick:()=>It(t),className:"px-3 md:px-4 py-1.5 md:py-2 rounded-xl text-xs md:text-sm text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 bg-gradient-to-r hover:brightness-110",style:{background:`linear-gradient(135deg, ${z}DD, ${K}DD)`},title:"Daha √ßox m…ôlumat ver",children:"Daha √ßox m…ôlumat ver"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.content||t.fullContent),a.success("M…ôtn kopyalandƒ±!")},className:"p-1 md:p-1.5 text-gray-400 hover:text-emerald-500 hover:bg-emerald-50 rounded-lg transition-all group/btn",title:"M…ôtn kopyala",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{name:"copy",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Kopyala"})]})}),e.jsx("button",{onClick:()=>{Qe(t),Ee(!0)},className:"p-1 md:p-1.5 text-gray-400 hover:text-orange-500 hover:bg-orange-50 rounded-lg transition-all group/btn",title:"S…ôhv cavab haqqƒ±nda bildi≈ü g√∂nd…ôr",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(u,{name:"warning",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Bildir"})]})})]})]})]},t.id||n))}),Ue&&e.jsx(Ut,{chatbotName:Ve}),Ue&&We&&e.jsx("div",{className:"mt-1 text-[12px] italic text-gray-500 dark:text-gray-400",children:We})]}),e.jsx("div",{className:"mt-3 md:mt-4",children:e.jsxs("div",{className:"relative bg-white/50 dark:bg-gray-800/50 backdrop-blur-lg rounded-2xl border border-white/30 dark:border-gray-700/30 shadow-2xl hover:shadow-3xl transition-all duration-300 p-1",children:[e.jsxs("div",{className:"relative flex items-end gap-2",children:[e.jsx("textarea",{ref:ce,className:`flex-1 bg-transparent border-none outline-none focus:outline-none focus:ring-0 resize-none text-sm md:text-base p-3 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-gray-100 min-h-[50px] max-h-[150px] ${J&&Q?"text-red-600 placeholder-red-400":""} ${U||E?"opacity-50 cursor-not-allowed":""}`,placeholder:ge?`Limit doldu - ${rt(me)}`:E?"√áatbot yazƒ±r... g√∂zl…ôyin":U?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin...":"Mesajƒ±nƒ±zƒ± yazƒ±n...",value:se,onChange:t=>{if(!U&&!E){const n=t.target.value;ve(re>0?n.slice(0,re):n)}try{const n=ce.current;if(n){n.style.height="auto";const d=(window.innerWidth<768,150);n.style.height=Math.min(n.scrollHeight,d)+"px"}}catch{}},onInput:()=>{try{const t=ce.current;if(t){t.style.height="auto";const n=(window.innerWidth<768,150);t.style.height=Math.min(t.scrollHeight,n)+"px"}}catch{}},onKeyDown:$t,disabled:U,rows:2}),e.jsxs("div",{className:"flex items-center gap-1 pb-3 pr-1",children:[e.jsx("button",{onClick:()=>ct(!de),className:`p-2 rounded-lg transition-all shadow-sm hover:shadow-md border backdrop-blur-sm ${de?"bg-emerald-500/90 text-white border-emerald-400/50 shadow-emerald-500/25":"bg-white/70 dark:bg-gray-700/70 text-gray-600 dark:text-gray-300 border-gray-300/50 dark:border-gray-600/50"}`,title:de?"Enter il…ô g√∂nd…ôr aktiv":"Enter il…ô g√∂nd…ôr deaktiv",children:e.jsx(u,{name:"enter",size:14})}),e.jsx("button",{onClick:()=>o||E?ot():st(),disabled:J&&Q||U,className:"p-3.5 md:p-4 rounded-2xl text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all shadow-lg hover:shadow-xl hover:scale-105 bg-gradient-to-r",style:{background:o||E||J&&Q||U?"#ef4444":`linear-gradient(135deg, ${z}DD, ${K}DD)`,boxShadow:`0 4px 20px ${o||E?"#ef444420":`${z}20`}`},title:o||E?"Dayandƒ±r":U?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin":"G√∂nd…ôr",children:e.jsx(u,{name:o||E?"stop":U?"shield_check":"send",size:18})})]})]}),e.jsx("div",{className:"absolute -bottom-12 right-2",children:e.jsxs("div",{className:"group relative inline-flex items-center justify-center",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full rounded-xl bg-gradient-to-r opacity-75 animate-ping",style:{backgroundImage:`linear-gradient(135deg, ${z}40, ${K}40)`,animationDuration:"2s"}}),e.jsx("span",{className:"absolute inline-flex h-full w-full rounded-xl bg-gradient-to-r opacity-75 animate-pulse",style:{backgroundImage:`linear-gradient(135deg, ${z}30, ${K}30)`,animationDuration:"1.5s"}}),e.jsx("button",{type:"button",onClick:()=>Ze(!0),className:"relative p-3 rounded-xl text-white font-medium flex items-center justify-center transition-all shadow-lg hover:shadow-xl hover:scale-105 backdrop-blur-sm cursor-pointer",style:{backgroundColor:z,boxShadow:`0 4px 20px ${z}20`},title:"Parametrl…ôr",children:e.jsx(u,{name:"settings",size:16,className:"animate-spin-slow",style:{animationDuration:"8s"}})})]})})]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs transition-all text-gray-800 ${J&&Q?"text-red-600 font-medium":J&&tt<50?"text-yellow-600":"dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]"}`,children:"Daxiletm…ô limiti:"}),e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2.5rem] h-6 px-2 rounded-full text-xs font-bold text-white shadow-sm transition-all",style:{backgroundColor:J&&Q?"#ef4444":J&&tt<50?"#eab308":K},children:re}),e.jsx("span",{className:"text-xs text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"simvol"}),xe>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"|"}),e.jsx("span",{className:"text-xs text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"istifad…ô:"}),e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2.5rem] h-6 px-2 rounded-full text-xs font-bold text-white shadow-sm transition-all",style:{backgroundColor:J&&Q?"#ef4444":z},children:xe})]})]}),J&&Q&&e.jsxs("p",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-red-100 dark:bg-red-900/30",children:"‚ö†Ô∏è"}),"Limit ke√ßildi!"]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 px-4 py-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg inline-block",children:["‚ö†Ô∏è ",Ct]})}),e.jsx("p",{className:"text-xs mt-1 text-center text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:de?e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"g√∂nd…ôr"}),", ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Shift+Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"yeni s…ôtir"})]}):e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"yeni s…ôtir"})]})})]})})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Ft,{footerSettings:m})})]}),e.jsx(Ht,{}),e.jsx(Rt,{isOpen:ht,onAccept:Tt,onReject:Dt,siteName:ue}),ut&&Bt.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",onClick:()=>_e(!1),children:[e.jsx("div",{className:"absolute inset-0"}),e.jsxs("div",{className:"absolute w-[18rem] md:w-[20rem] p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-2xl text-xs text-gray-700 dark:text-gray-200 limit-popover-animate backdrop-blur-lg",style:{top:Xe.top,left:Xe.left},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"font-semibold mb-1",children:"Limit qaydasƒ±"}),H.limit_type==="monthly"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"Aylƒ±q limit 30 g√ºnd…ôn bir b…ôrpa olunur. ƒ∞lk mesaj g√∂nd…ôrdiyiniz vaxt ba≈ülanƒüƒ±c n√∂qt…ôsidir."}),e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"N√ºmun…ô: ƒ∞lk mesajƒ± bu g√ºn 14:00-da g√∂nd…ôrmisinizs…ô, n√∂vb…ôti b…ôrpa 30 g√ºn sonra eyni tarix v…ô saatda olacaq."}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",H.monthly_reset_time?new Date(H.monthly_reset_time).toLocaleString("az-AZ"):"H…ôl…ô ba≈ülanmayƒ±b"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"G√ºnl√ºk limit yalnƒ±z 0-a d√º≈üd√ºkd…ô 24 saatlƒ±q geri sayƒ±m ba≈ülayƒ±r."}),e.jsxs("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["N√ºmun…ô: D√ºn…ôn 14:00-da istifad…ô etdiniz v…ô h…ôl…ô ",H.daily_remaining??H.remaining," qalƒ±bsa, sabah 14:00-da yenil…ônmir. 0 etdiyiniz andan 24 saat sonra b…ôrpa olacaq."]}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",H.reset_time?new Date(H.reset_time).toLocaleString("az-AZ"):"Limit bitm…ôyib"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"font-semibold mb-0.5",children:"‚ÄúSorƒüu‚Äù n…ôdir?"}),e.jsx("p",{children:"H…ôr g√∂nd…ôrdiyiniz mesaj 1 sorƒüudur."})]})]})]}),document.body),e.jsx(Gt,{isOpen:ft,onConfirm:_t,onCancel:St,chatTitle:O?.title||O?.session_id?.slice(0,8)||"",siteName:ue}),e.jsx(Wt,{isOpen:Nt,onClose:()=>Ze(!1),isAuthenticated:!!l?.user}),e.jsx(Xt,{isOpen:jt,onClose:()=>Ee(!1),messagePreview:qe?.content||qe?.fullContent||"",onSubmit:async({tags:t,comment:n})=>{const d=qe,i=d?.id,x=i!=null?String(i):void 0,j=`${t&&t.length?"["+t.join(", ")+"] ":""}${n||""}`.trim(),b={message_content:d?.content||d?.fullContent||"",session_id:N,timestamp:d?.created_at,user_info:l?.user?{name:l.user.name,email:l.user.email}:"Qonaq istifad…ô√ßi",comment:j||void 0};x!==void 0&&(b.message_id=x),Ee(!1),Qe(null),B.post("/chat/report-feedback",b).then(()=>a.success("Geribildiri≈üiniz g√∂nd…ôrildi!")).catch(R=>{console.error("Feedback report error:",R);const F=R?.response?.data?.error||R?.response?.data?.message||"X…ôta ba≈ü verdi";a.error("Geribildiri≈ü g√∂nd…ôrilm…ôdi: "+F)})}})]})})}export{lr as default};
