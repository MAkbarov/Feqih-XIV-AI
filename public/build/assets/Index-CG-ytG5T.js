import{j as e,M as Ct,r as zt,a as Tt}from"./markdown-CGR2RDhP.js";import{a as m,L as H,b as F,H as Dt}from"./vendor-4eYsLQor.js";import{I as p}from"./Icon-DkdgUjFj.js";import{a as be,u as at}from"./app-DkG26145.js";import{F as Mt}from"./Footer-CNFQBsO6.js";import{A as se}from"./index-DHi4oDk3.js";import{m as x}from"./proxy-CfrAqMoI.js";import{r as It}from"./index-Cn3or5DS.js";import"./app-BmCN8p5W.js";const $t=({className:c=""})=>{const{isDarkMode:i}=be(),[s,y]=m.useState(null),[b,r]=m.useState(!0),[k,T]=m.useState(!1),[P,v]=m.useState(!1);m.useEffect(()=>{const w=localStorage.getItem("donation_dismissed_until"),N=Date.now();if(w&&N<parseInt(w)){v(!0),r(!1);return}f()},[]);const f=async()=>{try{const N=await(await fetch("/api/donation-settings")).json();N&&N.enabled&&(y(N),setTimeout(()=>{T(!0)},2e3))}catch(w){console.error("Error fetching donation settings:",w)}finally{r(!1)}},S=()=>{v(!0),T(!1)},j=()=>{const w=Date.now()+6048e5;localStorage.setItem("donation_dismissed_until",w.toString()),v(!0),T(!1)};return b||!s||P?null:e.jsx(se,{children:k&&e.jsx(x.div,{className:"fixed inset-0 backdrop-blur-lg flex items-center justify-center z-50 p-4 modal-overlay",style:{background:i?"linear-gradient(135deg, rgba(31, 41, 55, 0.85) 0%, rgba(17, 24, 39, 0.9) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.85) 0%, rgba(255, 255, 255, 0.9) 100%) !important"},initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>T(!1),children:e.jsxs(x.div,{className:`max-w-md w-full rounded-3xl shadow-2xl relative overflow-hidden border-2 backdrop-blur-md modal-content donation-modal ${i?"dark":""} ${i?"border-gray-600/50":"border-gray-200/50"}`,style:{background:s.background_color||(i?"linear-gradient(135deg, rgba(31, 41, 55, 0.95) 0%, rgba(17, 24, 39, 0.98) 100%) !important":"linear-gradient(135deg, rgba(249, 250, 251, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%) !important"),color:s.text_color||(i?"#ffffff !important":"#333333 !important"),backdropFilter:"blur(20px)",boxShadow:i?"0 25px 50px -12px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05)":"0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(255, 255, 255, 0.1)"},initial:{scale:.8,opacity:0,y:50,rotateX:15},animate:{scale:1,opacity:1,y:0,rotateX:0},exit:{scale:.8,opacity:0,y:50,rotateX:15},transition:{type:"spring",damping:25,stiffness:300,duration:.5},whileHover:{scale:1.02,y:-5},onClick:w=>w.stopPropagation(),children:[e.jsx(x.button,{onClick:S,className:`absolute top-5 right-5 w-10 h-10 flex items-center justify-center rounded-full transition-all duration-300 z-10 text-xl font-medium ${i?"bg-gray-700/70 hover:bg-gray-600/80 text-gray-300 hover:text-white border border-gray-600/50":"bg-gray-100/70 hover:bg-gray-200/80 text-gray-600 hover:text-gray-800 border border-gray-200/50"}`,whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},children:"√ó"}),e.jsxs("div",{className:"p-8",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(x.h3,{className:"text-2xl font-bold mb-6 pr-10 leading-tight",style:{color:s.text_color||(i?"#ffffff":"#333333")},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},children:s.title}),e.jsx(x.div,{className:`text-base leading-relaxed prose max-w-none ${i?"dark:prose-invert":""}`,style:{color:s.text_color||(i?"#ffffff":"#333333"),"--tw-prose-body":s.text_color||(i?"#ffffff":"#333333"),"--tw-prose-headings":s.text_color||(i?"#ffffff":"#333333"),"--tw-prose-bold":s.text_color||(i?"#ffffff":"#333333"),"--tw-prose-links":s.text_color||(i?"#ffffff":"#333333")},dangerouslySetInnerHTML:{__html:s.content},initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2}})]}),e.jsxs(x.div,{className:"space-y-4",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx(x.div,{className:"flex-1",children:e.jsx(H,{href:"/donation",className:"w-full block px-6 py-4 rounded-xl font-bold text-white text-center transition-all duration-300 shadow-lg",style:{backgroundColor:s.button_color||"#3b82f6"},onMouseEnter:w=>{w.target.style.filter="brightness(110%)",w.target.style.transform="translateY(-2px)",w.target.style.boxShadow="0 20px 40px rgba(0,0,0,0.2)"},onMouseLeave:w=>{w.target.style.filter="brightness(100%)",w.target.style.transform="translateY(0px)",w.target.style.boxShadow="0 10px 25px rgba(0,0,0,0.1)"},children:"üíù D…ôst…ôk Ol"})}),e.jsx(x.button,{className:`px-6 py-4 rounded-xl font-medium transition-all duration-300 hover:shadow-md backdrop-blur-sm ${i?"text-gray-300 border border-gray-600/60 hover:bg-gray-700/60 hover:border-gray-500":"text-gray-600 border border-gray-300/60 hover:bg-gray-50/60 hover:border-gray-400"}`,onClick:S,whileHover:{scale:1.05},whileTap:{scale:.95},children:"Baƒüla"})]}),e.jsx(x.button,{className:`w-full text-sm underline transition-colors py-2 rounded-lg ${i?"text-gray-400 hover:text-gray-200 hover:bg-gray-700/30":"text-gray-500 hover:text-gray-700 hover:bg-gray-100/30"}`,onClick:j,whileHover:{scale:1.02},children:"1 h…ôft…ô g√∂st…ôrm…ô"})]})]})]})})})},Lt=({isOpen:c,onAccept:i,onReject:s,siteName:y="XIV AI"})=>{const{theme:b}=be(),[r,k]=m.useState(!1),[T,P]=m.useState(null),[v,f]=m.useState(!0),S=async()=>{try{const w=await(await fetch("/api/guest-terms")).json();P(w)}catch{console.warn("Failed to fetch admin terms, using fallback"),P({title:"ƒ∞stifad…ô ≈û…ôrtl…ôri",content:"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"})}finally{f(!1)}};return m.useEffect(()=>{c&&!T&&S()},[c]),m.useEffect(()=>(c?(k(!0),document.body.style.overflow="hidden"):document.body.style.overflow="auto",()=>{document.body.style.overflow="auto"}),[c]),c?e.jsx(se,{children:r&&e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:()=>s&&s()}),e.jsxs(x.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full mx-4 max-h-[90vh] overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:b?.primary_color?`linear-gradient(135deg, ${b.primary_color} 0%, ${b.secondary_color||b.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(p,{name:"shield_check",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:v?"ƒ∞stifad…ô ≈û…ôrtl…ôri":T?.title||"ƒ∞stifad…ô ≈û…ôrtl…ôri"}),e.jsx("p",{className:"text-blue-100 text-sm",children:y})]})]})}),e.jsx("div",{className:"p-6 overflow-y-auto max-h-96",children:v?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Y√ºkl…ônir..."})]}):e.jsx("div",{className:"text-gray-700 dark:text-gray-300 text-sm leading-relaxed",children:e.jsx("div",{className:"prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:T?.content||"<p>ƒ∞stifad…ô ≈ü…ôrtl…ôri y√ºkl…ônm…ôdi.</p>"}})})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:b?.primary_color?`linear-gradient(135deg, ${b.primary_color}15 0%, ${b.secondary_color||b.primary_color}15 100%)`:"linear-gradient(135deg, #10b98115 0%, #065f4615 100%)"},children:[e.jsxs("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{name:"close",size:16}),e.jsx("span",{children:"R…ôdd et"})]}),e.jsxs("button",{onClick:i,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl",style:{background:b?.primary_color?`linear-gradient(135deg, ${b.primary_color} 0%, ${b.secondary_color||b.primary_color} 100%)`:"linear-gradient(135deg, #10b981 0%, #065f46 100%)",filter:"brightness(1)",":hover":{filter:"brightness(1.1)"}},onMouseEnter:j=>j.target.style.filter="brightness(1.1)",onMouseLeave:j=>j.target.style.filter="brightness(1)",children:[e.jsx(p,{name:"shield_check",size:16}),e.jsx("span",{children:"Q…ôbul edir…ôm"})]})]})]})]})}):null},At=({isOpen:c,onConfirm:i,onCancel:s,chatTitle:y="",siteName:b=""})=>{const{theme:r}=be();return c?e.jsx(se,{children:e.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center p-4",children:[e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},className:"absolute inset-0 bg-black/70 backdrop-blur-md",onClick:s}),e.jsxs(x.div,{initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{duration:.3,type:"spring",stiffness:300,damping:25},className:"relative z-50 bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full mx-4 overflow-hidden border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 text-white",style:{background:r?.primary_color?`linear-gradient(135deg, ${r.primary_color} 0%, ${r.secondary_color||r.primary_color} 100%)`:"linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"},children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-lg",children:e.jsx(p,{name:"warning",size:24,color:"white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:"S√∂hb…ôti Sil"}),e.jsx("p",{className:"text-blue-100 text-sm",children:b})]})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"text-gray-700 dark:text-gray-300",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-full flex items-center justify-center",children:e.jsx(p,{name:"warning",size:24,color:"#ef4444"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-medium text-gray-900 dark:text-gray-100",children:"Bu s√∂hb…ôti silm…ôk ist…ôdiyinizd…ôn …ôminsiz?"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Bu …ôm…ôl geri alƒ±na bilm…ôz."})]})]}),y&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4 mb-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Silin…ôc…ôk s√∂hb…ôt:"}),e.jsxs("p",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:['"',y,'"']})]})]})}),e.jsxs("div",{className:"p-6 border-t border-gray-200 dark:border-gray-600 flex gap-3",style:{background:r?.primary_color?`linear-gradient(135deg, ${r.primary_color}10 0%, ${r.secondary_color||r.primary_color}10 100%)`:"linear-gradient(135deg, #ef444415 0%, #dc262615 100%)"},children:[e.jsxs("button",{onClick:s,className:"flex-1 px-4 py-3 bg-gray-300 dark:bg-gray-600 text-gray-700 dark:text-gray-300 rounded-lg font-medium hover:bg-gray-400 dark:hover:bg-gray-500 transition-colors flex items-center justify-center gap-2",children:[e.jsx(p,{name:"close",size:16}),e.jsx("span",{children:"L…ôƒüv et"})]}),e.jsxs("button",{onClick:i,className:"flex-1 px-4 py-3 text-white rounded-lg font-medium transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-xl bg-red-500 hover:bg-red-600",children:[e.jsx(p,{name:"delete",size:16}),e.jsx("span",{children:"Sil"})]})]})]})]})}):null},Et=({className:c="",chatbotName:i="AI Assistant"})=>{const{theme:s}=be(),y=s?.primary_color||"#6366f1",b=s?.text_color||"#1f2937";return e.jsxs("div",{className:`inline-flex items-center space-x-3 px-4 py-2 rounded-full ${c}`,style:{backgroundColor:`${y}10`},children:[e.jsxs("span",{className:"text-sm font-semibold",style:{color:b},children:[i," yazƒ±r"]}),e.jsxs("div",{className:"flex space-x-1.5",children:[e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot1 1.8s infinite ease-in-out"}}),e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot2 1.8s infinite ease-in-out"}}),e.jsx("div",{className:"w-2.5 h-2.5 rounded-full animate-pulse",style:{backgroundColor:y,animation:"typingDot3 1.8s infinite ease-in-out"}})]}),e.jsx("style",{jsx:!0,children:`
        @keyframes typingDot1 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          30% { transform: scale(1.2); opacity: 1; }
        }
        @keyframes typingDot2 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          45% { transform: scale(1.2); opacity: 1; }
        }
        @keyframes typingDot3 {
          0%, 60%, 100% { transform: scale(1); opacity: 0.7; }
          60% { transform: scale(1.2); opacity: 1; }
        }
      `})]})},qt=({isOpen:c,onClose:i,isAuthenticated:s=!1})=>{const[y,b]=m.useState("color"),[r,k]=m.useState({type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null}),[T,P]=m.useState(!1),v=at(),f=(a,n)=>{const g=document.querySelector("#chat-container, [data-chat-background]");g&&n&&(console.log("Applying color preview:",{type:a,value:n}),g.style.setProperty("background-image","","important"),g.style.setProperty("background-size","","important"),g.style.setProperty("background-position","","important"),g.style.setProperty("background-repeat","","important"),g.style.setProperty("background-color","","important"),g.style.setProperty("background","","important"),g.style.setProperty("background-attachment","","important"),g.style.setProperty("background-origin","","important"),g.style.setProperty("background-clip","","important"),setTimeout(()=>{a==="solid"?(g.style.setProperty("background-color",n,"important"),g.style.setProperty("background-image","none","important"),g.style.setProperty("background","none","important"),g.style.setProperty("background-size","auto","important"),g.style.setProperty("background-position","0% 0%","important"),g.style.setProperty("background-repeat","repeat","important"),g.style.setProperty("background-attachment","scroll","important"),g.style.setProperty("background-origin","padding-box","important"),g.style.setProperty("background-clip","border-box","important"),console.log("Applied solid color preview:",n),setTimeout(()=>{console.log("Solid color verification:",{backgroundColor:g.style.backgroundColor,background:g.style.background,backgroundImage:g.style.backgroundImage,computedStyles:window.getComputedStyle(g).background})},100)):a==="gradient"&&(g.style.setProperty("background",n,"important"),g.style.setProperty("background-color","","important"),console.log("Applied gradient preview:",n)),window.dispatchEvent(new CustomEvent("backgroundChanged",{detail:{type:a,background:n}}))},10))};m.useEffect(()=>{c&&S()},[c,s]),m.useEffect(()=>{r&&r.type&&s&&(console.log("Settings changed, applying background:",r.type),D())},[r.type,r.color,r.gradient,r.image,s]),m.useEffect(()=>{c&&r&&r.type&&(console.log("Modal opened, applying preview for type:",r.type),r.type==="solid"?f("solid",r.color||"#f3f4f6"):r.type==="gradient"?f("gradient",r.gradient||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"):r.type==="image"&&r.image&&R(r))},[c,r.type,r.color,r.gradient,r.image]);const S=async()=>{console.log("loadCurrentSettings called, isAuthenticated:",s);try{let a=null;if(s){console.log("Loading settings from API...");const n=await F.get("/api/user/background-settings");console.log("API response:",n.data),n.data.success?(a=n.data.settings,console.log("Loaded settings from API:",a),k(a)):(console.warn("API returned success=false"),a={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null,imageSize:"cover",imagePosition:"center"},k(a))}else{console.log("Loading settings from cookies...");const n=j("guest_background_settings");if(console.log("Cookie settings:",n),n)try{a=JSON.parse(n),console.log("Parsed cookie settings:",a),k(a)}catch(g){console.warn("Failed to parse guest background settings:",g),a={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null},k(a)}else a={type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null},k(a)}console.log("Setting active tab based on settings type:",a?.type),a&&a.type==="image"?(console.log("Setting active tab to image because type is image"),b("image")):(console.log("Setting active tab to color because type is solid/gradient:",a?.type),b("color"))}catch(a){console.error("Error loading background settings:",a),k({type:"solid",color:"#f3f4f6",gradient:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",image:null}),b("color")}},j=a=>{const g=`; ${document.cookie}`.split(`; ${a}=`);return g.length===2?g.pop().split(";").shift():null},w=(a,n,g)=>{const C=new Date;C.setTime(C.getTime()+g*24*60*60*1e3),document.cookie=`${a}=${n};expires=${C.toUTCString()};path=/`},N=async()=>{console.log("handleSave called with settings:",r),P(!0);try{if(s){const a={type:r.type,color:r.type==="solid"?r.color:null,gradient:r.type==="gradient"?r.gradient:null,image:r.type==="image"?r.image:null,imageSize:r.type==="image"?r.imageSize:null,imagePosition:r.type==="image"?r.imagePosition:null};console.log("Sending save data:",a),console.log("Current settings:",r);const n=await F.post("/api/user/background-settings",a);console.log("Save response:",n.data),console.log("Current settings after save:",r),n.data.success?(v.success("Arxa fon parametrl…ôri saxlanƒ±ldƒ±!"),D(),i()):(console.log("Save failed:",n.data),v.error("X…ôta ba≈ü verdi!"))}else w("guest_background_settings",JSON.stringify(r),70),v.success("Arxa fon parametrl…ôri saxlanƒ±ldƒ±!"),D(),i()}catch(a){console.error("Save error:",a),v.error("Saxlama zamanƒ± x…ôta ba≈ü verdi!")}finally{P(!1)}},D=()=>{console.log("applyBackground called with settings:",r);const a=document.querySelector("#chat-container, [data-chat-background]");if(console.log("Chat container found:",a),a){let n="";switch(r.type){case"solid":n=r.color||"#f3f4f6",console.log("Solid color background style:",n);break;case"gradient":n=r.gradient,console.log("Gradient background style:",n);break;case"image":if(r.image){let g=r.image;!g.startsWith("http")&&!g.startsWith("/")&&(g="/"+g),n=`url(${g})`,a.style.backgroundSize=r.imageSize||"cover",a.style.backgroundPosition=r.imagePosition||"center",a.style.backgroundRepeat="no-repeat",console.log("Applied image background:",{url:g,size:r.imageSize||"cover",position:r.imagePosition||"center"})}else n=r.color||"#f3f4f6";break;default:n="#f3f4f6"}console.log("Applying background style:",n),r.type==="image"?(a.style.setProperty("background-image",n,"important"),a.style.setProperty("background-size",r.imageSize||"cover","important"),a.style.setProperty("background-position",r.imagePosition||"center","important"),a.style.setProperty("background-repeat","no-repeat","important"),a.style.setProperty("background-color","","important")):(a.style.setProperty("background-image","","important"),a.style.setProperty("background-size","","important"),a.style.setProperty("background-position","","important"),a.style.setProperty("background-repeat","","important"),r.type==="gradient"?(a.style.setProperty("background",n,"important"),a.style.setProperty("background-color","","important")):r.type==="solid"?(a.style.setProperty("background","none","important"),a.style.setProperty("background-image","none","important"),a.style.setProperty("background-size","auto","important"),a.style.setProperty("background-position","0% 0%","important"),a.style.setProperty("background-repeat","repeat","important"),a.style.setProperty("background-attachment","scroll","important"),a.style.setProperty("background-origin","padding-box","important"),a.style.setProperty("background-clip","border-box","important"),a.style.setProperty("background-color",n,"important"),console.log("Applied solid color with full reset:",n)):(a.style.setProperty("background-color",n,"important"),a.style.setProperty("background","","important"))),window.dispatchEvent(new CustomEvent("backgroundChanged",{detail:{type:r.type,background:n,imageSize:r.imageSize,imagePosition:r.imagePosition}}))}else console.error("Chat container not found! Available elements:"),console.log("Elements with id chat-container:",document.querySelectorAll("#chat-container")),console.log("Elements with data-chat-background:",document.querySelectorAll("[data-chat-background]")),console.log("All divs on page:",document.querySelectorAll("div").length),console.log("Page body classes:",document.body.className)},R=a=>{const n=document.querySelector("#chat-container, [data-chat-background]");if(n&&a.image){let g=a.image;!g.startsWith("http")&&!g.startsWith("/")&&(g="/"+g),n.style.setProperty("background","","important"),n.style.setProperty("background-color","","important"),n.style.setProperty("background-image",`url(${g})`,"important"),n.style.setProperty("background-size",a.imageSize||"cover","important"),n.style.setProperty("background-position",a.imagePosition||"center","important"),n.style.setProperty("background-repeat","no-repeat","important"),console.log("Applied persistent preview:",{url:g,size:a.imageSize||"cover",position:a.imagePosition||"center"})}},fe=async()=>{if(console.log("Delete image called, current settings:",r),!r.image){console.log("No image to delete");return}P(!0);try{console.log("Sending delete request to /api/user/background-image");const a=await F.delete("/api/user/background-image",{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(console.log("Delete response:",a.data),a.data.success){k(g=>({...g,image:null,imageSize:"cover",imagePosition:"center",type:"solid",color:"#f3f4f6"})),b("color");const n=document.querySelector("#chat-container, [data-chat-background]");n&&(n.style.setProperty("background","none","important"),n.style.setProperty("background-image","none","important"),n.style.setProperty("background-size","auto","important"),n.style.setProperty("background-position","0% 0%","important"),n.style.setProperty("background-repeat","repeat","important"),n.style.setProperty("background-attachment","scroll","important"),n.style.setProperty("background-origin","padding-box","important"),n.style.setProperty("background-clip","border-box","important"),n.style.setProperty("background-color","#f3f4f6","important")),v.success("≈û…ôkil silindi!")}else v.error("≈û…ôkil silin…ôrk…ôn x…ôta ba≈ü verdi!")}catch(a){console.error("Delete error:",a),v.error("≈û…ôkil silin…ôrk…ôn x…ôta ba≈ü verdi!")}finally{P(!1)}},Y=async a=>{if(!a)return;if(a.size>400*1024){v.error("≈û…ôkil √∂l√ß√ºs√º 400KB-dan b√∂y√ºk ola bilm…ôz!");return}P(!0);const n=new FormData;n.append("image",a);try{const g=await F.post("/api/user/upload-background-image",n,{headers:{"Content-Type":"multipart/form-data","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}});if(g.data.success){console.log("Upload successful, URL:",g.data.url);const C={...r,image:g.data.url,imageSize:"cover",imagePosition:"center",type:"image"};k(C),R(C),v.success("≈û…ôkil y√ºkl…ôndi!")}else console.log("Upload failed:",g.data),v.error("≈û…ôkil y√ºkl…ônm…ôdi!")}catch(g){console.error("Upload error:",g),console.error("Upload error response:",g.response),g.response&&console.error("Upload error data:",g.response.data),v.error("≈û…ôkil y√ºkl…ônm…ô x…ôtasƒ±!")}finally{P(!1)}},V=[{name:"G√∂y-B…ôn√∂v≈ü…ôyi",value:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},{name:"√á…ôhrayƒ±-Narƒ±ncƒ±",value:"linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"},{name:"Ya≈üƒ±l-Mavi",value:"linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"},{name:"Qƒ±zƒ±l-Narƒ±ncƒ±",value:"linear-gradient(135deg, #ffa751 0%, #ff6b6b 100%)"},{name:"B…ôn√∂v≈ü…ôyi-√á…ôhrayƒ±",value:"linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"},{name:"T√ºnd Mavi",value:"linear-gradient(135deg, #1e3c72 0%, #2a5298 100%)"}];return c?e.jsx(se,{children:e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Arxa Fon Parametrl…ôri"}),e.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:e.jsx(p,{name:"close",size:20})})]}),e.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:()=>{b("color"),r.type==="image"&&k(a=>({...a,type:"solid"}))},className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${y==="color"?"text-purple-600 border-b-2 border-purple-600 bg-purple-50 dark:bg-purple-900/20":"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"}`,children:"R…ông & Gradient"}),e.jsxs("button",{onClick:()=>{b("image"),r.image&&(k(a=>({...a,type:"image"})),R(r))},disabled:!s,className:`flex-1 px-4 py-3 text-sm font-medium transition-colors ${y==="image"&&s?"text-purple-600 border-b-2 border-purple-600 bg-purple-50 dark:bg-purple-900/20":s?"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200":"text-gray-300 dark:text-gray-600 cursor-not-allowed"}`,children:["≈û…ôkil ",!s&&"üîí"]})]}),e.jsxs("div",{className:"p-6",children:[y==="color"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{console.log("Solid color selected");const a={...r,type:"solid"};k(a),f("solid",r.color||"#f3f4f6")},className:`flex-1 p-3 rounded-lg border-2 text-sm font-medium transition-all ${r.type==="solid"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:"Solid R…ông"}),e.jsx("button",{onClick:()=>{console.log("Gradient selected");const a={...r,type:"gradient"};k(a),f("gradient",r.gradient||"linear-gradient(135deg, #667eea 0%, #764ba2 100%)")},className:`flex-1 p-3 rounded-lg border-2 text-sm font-medium transition-all ${r.type==="gradient"?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300"}`,children:"Gradient"})]}),r.type==="solid"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"R…ông se√ßin"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("input",{type:"color",value:r.color,onChange:a=>{console.log("Color changed to:",a.target.value);const n={...r,color:a.target.value,type:"solid"};k(n),f("solid",a.target.value)},className:"w-16 h-12 rounded-lg border-2 border-gray-300 cursor-pointer"}),e.jsx("input",{type:"text",value:r.color,onChange:a=>{console.log("Color text changed to:",a.target.value);const n={...r,color:a.target.value,type:"solid"};k(n),f("solid",a.target.value)},className:"flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100",placeholder:"#f3f4f6"})]})]}),r.type==="gradient"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"X√ºsusi Gradient CSS"}),e.jsx("textarea",{value:r.gradient,onChange:a=>{console.log("Gradient changed to:",a.target.value);const n={...r,gradient:a.target.value,type:"gradient"};k(n),f("gradient",a.target.value)},className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 font-mono text-sm h-20",placeholder:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Hazƒ±r Gradientl…ôr"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:V.map((a,n)=>e.jsx("button",{onClick:()=>{const g={...r,gradient:a.value,type:"gradient"};k(g),f("gradient",a.value)},className:"text-xs px-3 py-2 border rounded-lg text-left hover:opacity-80 transition-opacity text-white font-medium",style:{background:a.value},children:a.name},n))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"√ñnizl…ôm…ô"}),e.jsx("div",{className:"w-full h-20 rounded-lg border-2 border-gray-200 flex items-center justify-center",style:{background:r.type==="solid"?r.color:r.gradient},children:e.jsx("span",{className:"bg-black/20 px-3 py-1 rounded text-white text-sm font-medium",children:"Arxa Fon N√ºmun…ôsi"})})]})]}),y==="image"&&e.jsx("div",{className:"space-y-4",children:s?e.jsxs(e.Fragment,{children:[r.image?e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center bg-gray-50 dark:bg-gray-800",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üö´"}),e.jsx("span",{className:"block text-sm font-medium text-gray-600 dark:text-gray-400 mb-1",children:"≈û…ôkil y√ºkl…ônib"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-500",children:"Ba≈üqa ≈ü…ôkil y√ºkl…ôm…ôk √º√ß√ºn m√∂vcud ≈ü…ôkili silin"})]}):e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üì∑"}),e.jsxs("label",{htmlFor:"background-image-upload",className:"cursor-pointer",children:[e.jsx("span",{className:"block text-sm font-medium text-gray-900 dark:text-gray-100 mb-1",children:"≈û…ôkil y√ºkl…ôyin"}),e.jsx("span",{className:"block text-sm text-gray-500 dark:text-gray-400",children:"PNG, JPG, GIF (Maksimum 400KB)"}),e.jsx("input",{id:"background-image-upload",type:"file",accept:"image/*",className:"sr-only",onChange:a=>Y(a.target.files[0])})]})]}),r.image&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Cari ≈û…ôkil"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{className:"w-full h-40 rounded-lg border-2 border-gray-200 overflow-hidden",style:{backgroundImage:`url(${r.image})`,backgroundSize:r.imageSize||"cover",backgroundPosition:r.imagePosition||"center",backgroundRepeat:"no-repeat"},children:e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-black/10",children:e.jsx("span",{className:"bg-white/90 px-2 py-1 rounded text-xs font-medium text-gray-700",children:"√ñnizl…ôm…ô"})})}),e.jsx("button",{onClick:fe,className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-7 h-7 flex items-center justify-center text-sm hover:bg-red-600 transition-colors",title:"≈û…ôkili sil",children:"√ó"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"≈û…ôkil √ñl√ß√ºs√º"}),e.jsx("div",{className:"flex gap-2",children:["cover","contain","auto","100% 100%"].map(a=>e.jsx("button",{onClick:()=>{const n={...r,imageSize:a};k(n),R(n)},className:`px-3 py-1 text-xs rounded-lg border transition-colors ${(r.imageSize||"cover")===a?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-700":"border-gray-200 dark:border-gray-600 hover:border-gray-300 text-gray-700 dark:text-gray-300"}`,children:a==="cover"?"Doldur":a==="contain"?"Sƒ±ƒüƒ±≈üdƒ±r":a==="auto"?"Orjinal":"Uzat"},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"≈û…ôkil M√∂vqeyi"}),e.jsx("div",{className:"grid grid-cols-3 gap-1 max-w-[120px]",children:[["top left","‚ÜñÔ∏è"],["top center","‚¨ÜÔ∏è"],["top right","‚ÜóÔ∏è"],["center left","‚¨ÖÔ∏è"],["center","‚≠ï"],["center right","‚û°Ô∏è"],["bottom left","‚ÜôÔ∏è"],["bottom center","‚¨áÔ∏è"],["bottom right","‚ÜòÔ∏è"]].map(([a,n])=>e.jsx("button",{onClick:()=>{const g={...r,imagePosition:a};k(g),R(g)},className:`w-8 h-8 text-xs rounded border flex items-center justify-center transition-colors ${(r.imagePosition||"center")===a?"border-purple-500 bg-purple-50 dark:bg-purple-900/20 text-purple-600":"border-gray-200 dark:border-gray-600 hover:border-gray-300 text-gray-500"}`,title:a,children:n},a))})]})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:"D…ôyi≈üiklikl…ôr real-time g√∂st…ôrilir"})]})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-6xl mb-4",children:"üîí"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"≈û…ôkil Y√ºkl…ôm…ô Qadaƒüandƒ±r"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"≈û…ôkil y√ºkl…ôm…ôk √º√ß√ºn hesaba daxil olmalƒ±sƒ±nƒ±z"})]})})]}),e.jsxs("div",{className:"flex gap-2 p-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{onClick:i,className:"flex-1 px-4 py-2 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"L…ôƒüv et"}),e.jsx("button",{onClick:async()=>{k({type:"default",color:"transparent",gradient:"",image:null,imageSize:"cover",imagePosition:"center"});const n=document.querySelector("#chat-container, [data-chat-background]");n&&(n.style.setProperty("background","","important"),n.style.setProperty("background-image","","important"),n.style.setProperty("background-size","","important"),n.style.setProperty("background-position","","important"),n.style.setProperty("background-repeat","","important"),n.style.setProperty("background-color","","important"),n.style.setProperty("background-attachment","","important"),n.style.setProperty("background-origin","","important"),n.style.setProperty("background-clip","","important"));try{if(P(!0),console.log("Sending reset request with current settings:",r),s){const g={type:"default",color:null,gradient:null,image:null,imageSize:null,imagePosition:null};console.log("Sending reset data to API:",g);const C=await F.post("/api/user/background-settings",g);console.log("Reset API response:",C.data),C.data.success?(console.log("Reset successful - background and file should be deleted"),v.success("Arxa fon v…ô ≈ü…ôkil sƒ±fƒ±rlandƒ±!")):(console.error("Reset failed:",C.data),v.error("Sƒ±fƒ±rlama uƒüursuz oldu!"))}else document.cookie="guest_background_settings=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",v.success("Qonaq parametrl…ôri sƒ±fƒ±rlandƒ±!");setTimeout(()=>{S()},500),i()}catch(g){console.error("Reset error details:",g),console.error("Error response:",g.response?.data),v.error("Sƒ±fƒ±rlama zamanƒ± x…ôta ba≈ü verdi: "+(g.response?.data?.message||g.message))}finally{P(!1)}},disabled:T,className:"px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 disabled:opacity-50 transition-colors text-sm",title:"Defolt r…ông…ô qaytar",children:"Sƒ±fƒ±rlamaq"}),e.jsx("button",{onClick:N,disabled:T,className:"flex-1 px-4 py-2 bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-lg hover:from-purple-600 hover:to-indigo-700 disabled:opacity-50 transition-colors",children:T?"Saxlanƒ±r...":"Yadda Saxla"})]})]})})}):null},Ft=c=>{const s=`; ${document.cookie}`.split(`; ${c}=`);return s.length===2?s.pop().split(";").shift():null},rt=c=>{console.log("BackgroundLoader: applyBackgroundFromSettings called",c);const i=document.querySelector("#chat-container, [data-chat-background]");if(console.log("BackgroundLoader: Chat container found:",i),!i){console.error("BackgroundLoader: Chat container not found!");return}let s="";switch(c.type){case"solid":s=c.color;break;case"gradient":s=c.gradient;break;case"image":if(c.image){let y=c.image;!y.startsWith("http")&&!y.startsWith("/")&&(y="/"+y),s=`url(${y})`,i.style.backgroundSize=c.imageSize||"cover",i.style.backgroundPosition=c.imagePosition||"center",i.style.backgroundRepeat="no-repeat",console.log("BackgroundLoader: Applied image background:",{url:y,size:c.imageSize||"cover",position:c.imagePosition||"center"})}else s=c.color||"#f3f4f6";break;default:s="#f3f4f6"}console.log("BackgroundLoader: Applying background style:",s),c.type==="image"?(i.style.backgroundImage=s,i.style.backgroundSize=c.imageSize||"cover",i.style.backgroundPosition=c.imagePosition||"center",i.style.backgroundRepeat="no-repeat",i.style.backgroundColor=""):(i.style.backgroundImage="",i.style.backgroundSize="",i.style.backgroundPosition="",i.style.backgroundRepeat="",c.type==="gradient"?(i.style.background=s,i.style.backgroundColor=""):c.type==="solid"?(i.style.setProperty("background","none","important"),i.style.setProperty("background-image","none","important"),i.style.setProperty("background-size","auto","important"),i.style.setProperty("background-position","0% 0%","important"),i.style.setProperty("background-repeat","repeat","important"),i.style.setProperty("background-attachment","scroll","important"),i.style.setProperty("background-origin","padding-box","important"),i.style.setProperty("background-clip","border-box","important"),i.style.setProperty("background-color",s,"important"),console.log("BackgroundLoader: Applied solid color with full reset:",s)):(i.style.backgroundColor=s,i.style.background=""))},Be=async(c=!1)=>{console.log("BackgroundLoader: loadUserBackground called, isAuthenticated:",c);try{if(c){console.log("BackgroundLoader: Loading from API for authenticated user");const i=await fetch("/api/user/background-settings",{headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(console.log("BackgroundLoader: API response status:",i.status),i.ok){const s=await i.json();console.log("BackgroundLoader: API response data:",s),s.success?rt(s.settings):console.warn("BackgroundLoader: API returned success=false")}else console.error("BackgroundLoader: API request failed with status:",i.status)}else{const i=Ft("guest_background_settings");if(i)try{const s=JSON.parse(i);rt(s)}catch(s){console.warn("Failed to parse guest background settings:",s)}}}catch(i){console.warn("Failed to load user background:",i)}},Bt=({text:c,speed:i=50,onComplete:s})=>{const[y,b]=m.useState(""),[r,k]=m.useState(0);return m.useEffect(()=>{b(""),k(0)},[c]),m.useEffect(()=>{if(r<c.length){const T=setTimeout(()=>{b(P=>P+c[r]),k(P=>P+1)},i);return()=>clearTimeout(T)}else r===c.length&&r>0&&s&&s()},[r,c,i,s]),e.jsx("span",{children:y})},Ht=({content:c})=>e.jsx(Ct,{remarkPlugins:[Tt],rehypePlugins:[zt],components:{h1:({node:i,...s})=>e.jsx("h1",{className:"text-2xl font-bold mb-1 text-gray-800 dark:text-gray-100",...s}),h2:({node:i,...s})=>e.jsx("h2",{className:"text-xl font-semibold mb-1 text-gray-800 dark:text-gray-100",...s}),h3:({node:i,...s})=>e.jsx("h3",{className:"text-lg font-medium mb-1 text-gray-700 dark:text-gray-200",...s}),h4:({node:i,...s})=>e.jsx("h4",{className:"text-base font-medium mb-1 text-gray-700 dark:text-gray-200",...s}),p:({node:i,...s})=>e.jsx("p",{className:"mb-1 leading-normal text-gray-800 dark:text-gray-200",...s}),strong:({node:i,...s})=>e.jsx("strong",{className:"font-bold text-gray-900 dark:text-gray-100",...s}),em:({node:i,...s})=>e.jsx("em",{className:"italic text-gray-800 dark:text-gray-200",...s}),ul:({node:i,...s})=>e.jsx("ul",{className:"list-disc list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...s}),ol:({node:i,...s})=>e.jsx("ol",{className:"list-decimal list-inside mb-1 space-y-0.5 text-gray-800 dark:text-gray-200",...s}),li:({node:i,...s})=>e.jsx("li",{className:"text-gray-800 dark:text-gray-200",...s}),blockquote:({node:i,...s})=>e.jsx("blockquote",{className:"border-l-4 border-emerald-400 pl-4 py-1 mb-1 bg-emerald-50 dark:bg-emerald-900/30 text-gray-700 dark:text-gray-300",...s}),code:({node:i,inline:s,...y})=>s?e.jsx("code",{className:"bg-gray-100 dark:bg-gray-700 px-1 py-0.5 rounded text-sm font-mono text-gray-800 dark:text-gray-200",...y}):e.jsx("code",{className:"block bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-sm font-mono text-gray-800 dark:text-gray-200 overflow-x-auto",...y}),a:({node:i,...s})=>e.jsx("a",{className:"text-emerald-600 dark:text-emerald-400 hover:text-emerald-700 dark:hover:text-emerald-300 underline",target:"_blank",rel:"noopener noreferrer",...s})},children:c});function Vt({auth:c,sessions:i=[],settings:s={},theme:y={},footerSettings:b={}}){const r=at(),{theme:k,isDarkMode:T,toggleDarkMode:P,refreshTheme:v}=be(),f=k||y,S={...f,isDarkMode:T,toggleDarkMode:P},[j,w]=m.useState(null),[N,D]=m.useState([]),[R,fe]=m.useState(""),[Y,V]=m.useState(!1),[a,n]=m.useState(!1),[g,C]=m.useState(!1),M=m.useRef(!1),I=m.useRef(0),[He,$]=m.useState(""),[ke,oe]=m.useState([]),[Pe,we]=m.useState(i||[]);m.useEffect(()=>{we(i||[])},[JSON.stringify(i)]);const[ne,st]=m.useState(!0),[ot,ve]=m.useState(new Set),[A,ee]=m.useState(!1),[E,U]=m.useState(!1);m.useEffect(()=>{console.log("Sidebar state:",E,"Window width:",window.innerWidth)},[E]);const[Re,Ce]=m.useState(null),[te,nt]=m.useState(new Map),[it,je]=m.useState(!1),ze=m.useRef(null),[Ge,lt]=m.useState({top:0,left:0,align:"left"}),We=t=>{try{const l=t.getBoundingClientRect(),d=8,o=window.innerWidth,u=l.right+320<o,h=u?Math.max(8,l.left):Math.max(8,l.right-320),q=Math.min(window.innerHeight-200,l.bottom+d);lt({top:q,left:h,align:u?"left":"right"})}catch{}},[Oe,dt]=m.useState(()=>{try{const t=localStorage.getItem("feedbackGiven"),l=t?JSON.parse(t):[];return new Set(l.map(String))}catch{return new Set}}),ct=t=>{try{const l=new Set(Oe);l.add(String(t)),dt(l),localStorage.setItem("feedbackGiven",JSON.stringify([...l]))}catch{}},L=m.useRef(null),ie=m.useRef(null),[gt,Te]=m.useState(!1),[mt,De]=m.useState(!1),[G,Q]=m.useState(!0),[ut,Me]=m.useState(!1),[X,Ie]=m.useState(null),[J,Ne]=m.useState(()=>{const t=Number(localStorage.getItem("messageFontScale"));return t&&t>=.85&&t<=1.4?t:1}),[pt,xt]=m.useState(!1),[$e,_e]=m.useState(new Map),[Ue,yt]=m.useState(null),[ht,Xe]=m.useState(!1);m.useEffect(()=>{try{localStorage.setItem("messageFontScale",String(J))}catch{}},[J]);const bt=async()=>{if(X)try{if(c?.user){const t=document.querySelector('meta[name="csrf-token"]').getAttribute("content");try{await F.delete(`/chat/${X.session_id}`,{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}catch{await F.post(`/chat/${X.session_id}/delete`,{},{headers:{"X-CSRF-TOKEN":t,"X-Requested-With":"XMLHttpRequest"}})}we(l=>l.filter(d=>d.session_id!==X.session_id)),j===X.session_id&&(w(null),D([]))}else{const l=JSON.parse(localStorage.getItem("guestChatSessions")||"[]").filter(d=>d.session_id!==X.session_id);localStorage.setItem("guestChatSessions",JSON.stringify(l)),oe(l),j===X.session_id&&(w(null),D([]))}r.success("S√∂hb…ôt silindi!")}catch(t){console.error("Delete session error:",t),r.error("S√∂hb…ôt silin…ôrk…ôn x…ôta ba≈ü verdi")}finally{Me(!1),Ie(null)}},ft=()=>{Me(!1),Ie(null)},[B,Le]=m.useState({allowed:!0,remaining:0,daily_remaining:0,monthly_remaining:0,reset_time:null,monthly_reset_time:null,user_type:"guest"}),[le,Ae]=m.useState(!1),[de,Ee]=m.useState(null),Je=s.chatbot_name||"AI Assistant",ce=s.site_name||"XIV AI Chatbot Platform",kt=s.chat_disclaimer_text||"√áatbotun cavablarƒ±nƒ± yoxlayƒ±n, s…ôhv ed…ô bil…ôr!",re=Number(s.message_input_limit||s.guest_input_limit||500),ge=s.ai_response_type||"typewriter",wt=Number(s.ai_typing_speed||50),Ke=Number(s.ai_thinking_time||1e3),K=!c?.user,me=R.length,Ye=re-me,Z=re>0&&me>re,_=f?.primary_color||y?.primary_color||"#17cf1a",ae=f?.secondary_color||y?.secondary_color||"#179207";f?.accent_color||y?.accent_color,f?.background_gradient||y?.background_gradient,f?.text_color||y?.text_color;const Se=(()=>{const t=typeof window<"u"?window.innerWidth<768:!1,l=S.isDarkMode,d=s||{},o=d.brand_logo_desktop_light,u=d.brand_logo_desktop_dark,h=d.brand_logo_mobile_light,q=d.brand_logo_mobile_dark;if(t){if(l&&q)return q;if(!l&&h)return h}else{if(l&&u)return u;if(!l&&o)return o}return d.brand_logo_url||""})(),qe=(()=>{const t=f?.chat_background_type;if(!t||t==="default"||t===null)return"transparent";switch(t){case"solid":return f?.chat_background_color||"transparent";case"gradient":return f?.chat_background_gradient||"transparent";case"image":return f?.chat_background_image?`url(${f.chat_background_image})`:"transparent";default:return"transparent"}})(),Qe=t=>{if(!t)return"";const d=t-new Date;if(d<=0)return"Yenil…ônir...";const o=Math.floor(d/(1e3*60*60)),u=Math.floor(d%(1e3*60*60)/(1e3*60)),h=Math.floor(d%(1e3*60)/1e3);return o>0?`${o} saat ${u} d…ôqiq…ô ${h} saniy…ô`:u>0?`${u} d…ôqiq…ô ${h} saniy…ô`:`${h} saniy…ô`},ue=async()=>{try{const l=await(await fetch(`/api/chat-limits?t=${Date.now()}`,{cache:"no-store"})).json();Le(l),l.allowed?(Ae(!1),(mt||c?.user)&&Q(!1)):(Ae(!0),Q(!0),l.reset_time&&Ee(new Date(l.reset_time)))}catch(t){console.error("Failed to fetch limits:",t)}};m.useEffect(()=>{if(c?.user)Q(!1),De(!0);else{const t=JSON.parse(localStorage.getItem("guestChatSessions")||"[]");oe(t),localStorage.getItem("guest-terms-accepted")==="true"?(De(!0),Q(!1)):(Te(!0),Q(!0))}ue()},[c?.user]),m.useEffect(()=>{ue();const t=setInterval(ue,3e4),l=setInterval(()=>{de&&de-new Date<=0&&(ue(),Ee(null))},1e3);return()=>{clearInterval(t),clearInterval(l)}},[de]),m.useEffect(()=>{const t=()=>{v&&v(),ue()};return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[v]),m.useEffect(()=>{const t=setTimeout(()=>{Be(!!c?.user),setTimeout(()=>{const d=document.querySelector("#chat-container, [data-chat-background]");d&&!d.style.backgroundImage&&!d.style.background&&(console.log("Chat background retry - first attempt may have failed"),Be(!!c?.user))},1e3)},500),l=d=>{if(d.detail&&d.detail.background){const o=document.querySelector("#chat-container, [data-chat-background]");o&&(d.detail.type==="image"?(o.style.backgroundImage=d.detail.background,o.style.backgroundSize=d.detail.imageSize||"cover",o.style.backgroundPosition=d.detail.imagePosition||"center",o.style.backgroundRepeat="no-repeat",o.style.backgroundColor=""):(o.style.backgroundImage="",o.style.backgroundSize="",o.style.backgroundPosition="",o.style.backgroundRepeat="",d.detail.type==="gradient"?(o.style.background=d.detail.background,o.style.backgroundColor=""):d.detail.type==="solid"?(o.style.setProperty("background","none","important"),o.style.setProperty("background-image","none","important"),o.style.setProperty("background-size","auto","important"),o.style.setProperty("background-position","0% 0%","important"),o.style.setProperty("background-repeat","repeat","important"),o.style.setProperty("background-attachment","scroll","important"),o.style.setProperty("background-origin","padding-box","important"),o.style.setProperty("background-clip","border-box","important"),o.style.setProperty("background-color",d.detail.background,"important"),console.log("Chat listener applied solid color:",d.detail.background)):(o.style.backgroundColor=d.detail.background,o.style.background="")))}setTimeout(()=>Be(!!c?.user),200)};return window.addEventListener("backgroundChanged",l),()=>{clearTimeout(t),window.removeEventListener("backgroundChanged",l)}},[c?.user]);const Ze=(t,l,d)=>{if(!c?.user){const o={session_id:t,title:l||t.slice(0,8),messages:d||[],created_at:new Date().toISOString()},u=JSON.parse(localStorage.getItem("guestChatSessions")||"[]"),h=u.findIndex(z=>z.session_id===t);h>=0?u[h]={...u[h],messages:d}:u.unshift(o);const q=u.slice(0,10);localStorage.setItem("guestChatSessions",JSON.stringify(q)),oe(q)}},vt=async t=>{if(c?.user)try{const{data:l}=await F.get(`/chat/${t}`);D(l.messages)}catch(l){r.error("S√∂hb…ôt y√ºkl…ônm…ôdi"),console.error("loadSession error:",l)}else{const l=ke.find(d=>d.session_id===t);l&&D(l.messages||[])}w(t)},jt=()=>{localStorage.setItem("guest-terms-accepted","true"),De(!0),le||Q(!1),Te(!1),r.success("ƒ∞stifad…ô ≈ü…ôrtl…ôri q…ôbul edildi! ƒ∞ndi √ßatbotla danƒ±≈üa bil…ôrsiniz.")},Nt=()=>{Te(!1),Q(!0),r.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn √ßatbotla danƒ±≈üa bilm…ôzsiniz.")},Ve=async()=>{if(!R.trim())return;if(A){r.warning("√áatbot h…ôl…ô d…ô yazƒ±r. Z…ôhm…ôt olmasa g√∂zl…ôyin.");return}if(G){r.warning("ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul etm…ôd…ôn mesaj g√∂nd…ôr…ô bilm…ôzsiniz.");return}if(Z){r.warning(`Daxiletm…ô limiti: ${re}. Cari: ${me} simvol`);return}const t={role:"user",content:R,created_at:new Date().toISOString()};D(o=>[...o,{...t,id:`local-${Date.now()}`}]),fe("");try{ie.current&&(ie.current.style.height="")}catch{}V(!0),n(!0),C(!0),M.current=!0,$("Sual g√∂nd…ôrildi...");const l=++I.current;try{clearTimeout(window.__ragPhaseTimer1),clearTimeout(window.__ragPhaseTimer2),clearTimeout(window.__ragPhaseTimer3),clearTimeout(window.__ragPhaseTimer4)}catch{}window.__ragPhaseTimer1=setTimeout(()=>{I.current===l&&M.current&&$("Embeddings hazƒ±rlanƒ±r...")},300),window.__ragPhaseTimer2=setTimeout(()=>{I.current===l&&M.current&&$("Vektor maƒüazasƒ±nda axtarƒ±≈ü...")},900),window.__ragPhaseTimer3=setTimeout(()=>{I.current===l&&M.current&&$("Kontekst toplanƒ±r...")},1500),window.__ragPhaseTimer4=setTimeout(()=>{I.current===l&&M.current&&$("Cavab formala≈üdƒ±rƒ±lƒ±r...")},2100);const d=new AbortController;Ce(d);try{const{data:o}=await F.post("/chat/send",{message:t.content,session_id:j},{signal:d.signal});if(!j){w(o.session_id);const z=t.content.slice(0,40),W=new Date().toISOString();if(c?.user){we(xe=>[{session_id:o.session_id,title:"",created_at:W},...xe]);let O=0;const pe=setInterval(()=>{O++;const xe=z.slice(0,O);we(ye=>ye.map(he=>he.session_id===o.session_id?{...he,title:xe}:he)),O>=z.length&&clearInterval(pe)},Math.max(20,Math.min(80,1e3/Math.max(5,z.length))))}else{const O={session_id:o.session_id,title:"",created_at:W,messages:[t]};oe(ye=>[O,...ye]);let pe=0;const xe=setInterval(()=>{pe++;const ye=z.slice(0,pe);oe(he=>he.map(Fe=>Fe.session_id===o.session_id?{...Fe,title:ye}:Fe)),pe>=z.length&&clearInterval(xe)},Math.max(20,Math.min(80,1e3/Math.max(5,z.length))))}}const u=`ai-${Date.now()}`;let h;if(ge==="instant"){C(!1),M.current=!1,n(!1),$(""),I.current++,h={role:"assistant",content:o.message,fullContent:o.message,id:u,created_at:new Date().toISOString(),isTyping:!1,ragMeta:o.rag?.metadata||null,isContinuation:!!o.continuation};const z=[...N,t,h];D(W=>[...W,h])}else C(!1),M.current=!1,n(!1),$(""),I.current++,h={role:"assistant",content:"",fullContent:o.message,id:u,created_at:new Date().toISOString(),isTyping:!0,ragMeta:o.rag?.metadata||null,isContinuation:!!o.continuation},D(z=>[...z,h]),ee(!0),setTimeout(()=>{ve(z=>new Set([...z,u]))},Ke);const q=[...N,t,h];if(!c?.user){const z=j||o.session_id;Ze(z,t.content,q)}o.limit_info&&Le({allowed:o.limit_info.remaining>0,remaining:o.limit_info.remaining,daily_remaining:o.limit_info.daily_remaining,monthly_remaining:o.limit_info.monthly_remaining,reset_time:o.limit_info.reset_time,monthly_reset_time:o.limit_info.monthly_reset_time,user_type:c?.user?"user":"guest"})}catch(o){if(o.name==="CanceledError")r.info("Mesaj g√∂nd…ôrm…ô dayandƒ±rƒ±ldƒ±");else if(o.response?.status===429){const u=o.response.data;r.error(u.error||"Mesaj limiti dolmu≈üdur!"),u.limit_exceeded&&(Ae(!0),Q(!0),u.reset_time&&Ee(new Date(u.reset_time)),Le({allowed:!1,remaining:u.remaining||0,daily_remaining:u.daily_remaining||0,monthly_remaining:u.monthly_remaining||0,reset_time:u.reset_time,monthly_reset_time:u.monthly_reset_time,user_type:c?.user?"user":"guest"}))}else r.error(o.response?.data?.error||"X…ôta ba≈ü verdi");ee(!1)}finally{V(!1),Ce(null),setTimeout(()=>{n(!1),C(!1),M.current=!1,I.current++,ge==="instant"&&ee(!1)},600),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50)}},_t=t=>{const l=N.findIndex(d=>(d.id||"")===(t.id||""));for(let d=l-1;d>=0;d--)if(N[d]?.role==="user"&&typeof N[d].content=="string")return N[d].content;for(let d=N.length-1;d>=0;d--)if(N[d]?.role==="user")return N[d].content;return"Davam et"},St=async t=>{if(!t?.ragMeta?.dominant_kb_id)return;if(A){r.warning("√áatbot h…ôl…ô d…ô yazƒ±r. Z…ôhm…ôt olmasa g√∂zl…ôyin.");return}const l=t.ragMeta.dominant_kb_id,d=t.ragMeta.max_used_chunk_index_for_dominant??-1,o=_t(t);V(!0),n(!0),C(!0),M.current=!0,$("Davamƒ± hazƒ±rlanƒ±r...");const u=++I.current;try{clearTimeout(window.__ragPhaseTimer1),clearTimeout(window.__ragPhaseTimer2),clearTimeout(window.__ragPhaseTimer3),clearTimeout(window.__ragPhaseTimer4)}catch{}window.__ragPhaseTimer1=setTimeout(()=>{I.current===u&&M.current&&$("Embeddings hazƒ±rlanƒ±r...")},300),window.__ragPhaseTimer2=setTimeout(()=>{I.current===u&&M.current&&$("Vektor maƒüazasƒ±nda axtarƒ±≈ü...")},900),window.__ragPhaseTimer3=setTimeout(()=>{I.current===u&&M.current&&$("Kontekst toplanƒ±r...")},1500),window.__ragPhaseTimer4=setTimeout(()=>{I.current===u&&M.current&&$("Cavab formala≈üdƒ±rƒ±lƒ±r...")},2100);try{const{data:h}=await F.post("/chat/send",{message:o,session_id:j,continue:!0,kb_id:l,start_after_index:d}),q=`ai-${Date.now()}`;C(!1),M.current=!1,n(!1),$(""),I.current++;const z={role:"assistant",content:"",fullContent:h.message,id:q,created_at:new Date().toISOString(),isTyping:ge!=="instant",ragMeta:h.rag?.metadata||null,isContinuation:!0};D(W=>[...W,z]),ge==="instant"?(D(W=>W.map(O=>O.id===q?{...O,content:O.fullContent,isTyping:!1}:O)),$("Cavab hazƒ±rlandƒ±.")):(ee(!0),setTimeout(()=>{ve(W=>new Set([...W,q])),$("Cavab yazƒ±lƒ±r...")},Ke))}catch(h){r.error(h.response?.data?.error||"X…ôta ba≈ü verdi")}finally{V(!1),setTimeout(()=>{n(!1),C(!1),M.current=!1,I.current++,ge==="instant"&&ee(!1)},600),setTimeout(()=>L.current?.scrollTo({top:L.current.scrollHeight,behavior:"smooth"}),50)}},et=async()=>{Re&&(Re.abort(),Ce(null));try{await F.post("/chat/stop")}catch{}V(!1),n(!1),ee(!1),ve(new Set),r.info("Cavab yazmaq dayandƒ±rƒ±ldƒ±")},tt=async(t,l,d)=>{ct(t);try{nt(u=>{const h=new Map(u);return h.set(t,d),h}),await F.post("/chat/feedback",{message_id:t,session_id:j,message_content:l,feedback_type:d});const o=d==="like"?"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, bu bizi sevindirir. :)":"R…ôyiniz √º√ß√ºn t…ô≈ü…ôkk√ºr edirik, biz √ßatbotu t…ôkmil…ô≈üdir…ôc…ôyik, z…ôif t…ôcr√ºb…ômiz √º√ß√ºn √ºzr ist…ôyirik.";r.success(o)}catch(o){console.error("Feedback error:",o);const u=o?.response?.data?.error||"B…ôy…ôn/B…ôy…ônm…ô g√∂nd…ôrilm…ôdi";r.error(u)}},Pt=t=>{t.key==="Enter"&&ne&&!t.shiftKey&&(t.preventDefault(),Y||A?et():!G&&!A&&Ve())};return m.useEffect(()=>{L.current&&(L.current.scrollTop=L.current.scrollHeight)},[N]),m.useEffect(()=>{L.current&&L.current.scrollTo({top:L.current.scrollHeight,behavior:"smooth"})},[N]),m.useEffect(()=>{if(L.current&&A){const t=setInterval(()=>{try{const l=L.current;l.scrollTop=l.scrollHeight}catch{}},150);return()=>clearInterval(t)}},[A,N]),m.useEffect(()=>{const t=l=>{ze.current&&!ze.current.contains(l.target)&&je(!1)};return document.addEventListener("click",t),()=>document.removeEventListener("click",t)},[]),m.useEffect(()=>{const t=l=>{l.key==="Escape"&&E&&U(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[E]),m.useEffect(()=>(E&&window.innerWidth<768?(document.body.style.overflow="hidden",document.body.style.paddingRight="0px"):(document.body.style.overflow="",document.body.style.paddingRight=""),()=>{document.body.style.overflow="",document.body.style.paddingRight=""}),[E]),m.useEffect(()=>{const t=()=>{window.innerWidth>=768&&E&&(console.log("Desktop-a ke√ßildi, sidebar baƒülanƒ±r"),U(!1))};return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[E]),e.jsx("div",{className:`${S.isDarkMode?"dark":""}`,children:e.jsxs("div",{className:"h-screen flex flex-col overflow-x-hidden",style:{background:S.isDarkMode?f?.dark_background_gradient||"linear-gradient(135deg, #1f2937 0%, #111827 100%)":f?.background_gradient||"linear-gradient(135deg, #f9fafb 0%, #ffffff 100%)",backgroundAttachment:"fixed",minHeight:"100dvh"},children:[e.jsx(Dt,{title:`∆èsas s…ôhif…ô - ${ce}`}),e.jsxs("div",{className:"w-full px-4 md:px-4 lg:px-6 py-4 md:py-4 lg:py-6 flex-1 flex flex-col min-h-0",children:[e.jsxs(x.header,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},className:"mb-4 md:mb-6 flex flex-wrap items-center justify-between bg-gradient-to-r from-white/95 via-white/90 to-white/95 dark:from-gray-800/95 dark:via-gray-800/90 dark:to-gray-800/95 backdrop-blur-xl rounded-3xl p-4 md:p-6 shadow-2xl shadow-purple-500/10 dark:shadow-purple-500/20 w-full border border-white/20 dark:border-gray-700/50 hover:shadow-3xl transition-all duration-300",children:[e.jsxs(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},className:"flex items-start md:items-center gap-3",children:[e.jsx(x.button,{whileHover:{scale:1.05,rotate:5},whileTap:{scale:.95},onClick:t=>{t.preventDefault(),t.stopPropagation(),console.log("Toggle button clicked:",!E),U(!E)},onTouchStart:t=>{t.preventDefault(),t.stopPropagation(),console.log("Toggle touch start")},onTouchEnd:t=>{t.preventDefault(),t.stopPropagation();const l=!E;console.log("Toggle touch end, changing state from",E,"to",l),U(l)},className:"md:hidden p-3 rounded-xl bg-gradient-to-br from-purple-500/10 to-indigo-500/10 text-gray-700 dark:text-gray-300 hover:from-purple-500/20 hover:to-indigo-500/20 border border-purple-200/30 dark:border-purple-700/30 backdrop-blur-sm transition-all duration-300 shadow-lg hover:shadow-xl","aria-label":"S√∂hb…ôt tarix√ß…ôsi",type:"button",style:{touchAction:"manipulation",WebkitTouchCallout:"none",WebkitUserSelect:"none"},children:e.jsx(p,{name:"menu",size:20})}),e.jsxs(x.h1,{initial:{opacity:0,x:-15},animate:{opacity:1,x:0},transition:{duration:.6,delay:.3},className:"hidden md:flex text-lg md:text-2xl lg:text-3xl font-bold bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent items-center gap-3 hover:from-purple-600 hover:via-indigo-600 hover:to-purple-600 transition-all duration-500",children:[s.brand_mode==="logo"&&(Se||s.brand_logo_url)?e.jsx(x.img,{whileHover:{scale:1.1,rotate:5},src:Se||s.brand_logo_url,alt:"logo",className:"w-8 h-8 md:w-10 md:h-10 object-contain rounded-xl shadow-lg border border-white/20 dark:border-gray-700/50"}):s.brand_mode==="icon"?e.jsx(x.div,{whileHover:{scale:1.1,rotate:5},className:"p-2 rounded-xl bg-gradient-to-br from-purple-500/10 to-indigo-500/10 border border-purple-200/30 dark:border-purple-700/30 shadow-lg",children:e.jsx(p,{name:s.brand_icon_name||"nav_chat",size:28,color:_})}):null,e.jsx(x.span,{whileHover:{scale:1.02},className:"truncate font-extrabold tracking-wide",children:ce})]}),e.jsxs("div",{className:"md:hidden flex flex-col gap-1 ml-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-[12px] font-medium text-gray-700 dark:text-gray-300",ref:ze,children:[e.jsx(p,{name:"limit",size:18}),e.jsxs("span",{children:[B.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz"]}),e.jsx("span",{className:"text-white px-2 py-0.5 rounded-full",style:{backgroundColor:_},children:B.remaining})," sorƒüu",e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),We(t.currentTarget),je(l=>!l)},className:"ml-1 p-1 rounded-md text-gray-800 hover:text-black hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-110",title:"Limit haqqƒ±nda",children:e.jsx(p,{name:"limit_info",size:18})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{name:"sun",size:16,color:S.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.isDarkMode,onChange:()=>S.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(p,{name:"moon",size:16,color:S.isDarkMode?"#60a5fa":"#9ca3af"})]})]})]}),e.jsxs(x.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.6,delay:.4},className:"hidden md:flex items-center gap-3 flex-wrap justify-end",children:[e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},className:`relative px-4 py-2 rounded-xl text-xs font-semibold backdrop-blur-sm border shadow-lg transition-all duration-300 ${le?"bg-gradient-to-r from-red-50 to-red-100 text-red-800 border-red-200 shadow-red-200/50":B.remaining<=5?"bg-gradient-to-r from-yellow-50 to-yellow-100 text-yellow-800 border-yellow-200 shadow-yellow-200/50":"bg-gradient-to-r from-green-50 to-green-100 text-green-800 border-green-200 shadow-green-200/50"}`,children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{name:le?"warning":"limit",size:12}),e.jsx("span",{children:le?e.jsxs(e.Fragment,{children:["M…ôhdudiyy…ôt! - ",Qe(de)]}):e.jsxs(e.Fragment,{children:[B.limit_type==="monthly"?"Aylƒ±q":"G√ºnl√ºk"," limitiniz ",B.remaining," sorƒüu(√ßƒ±xƒ±≈ü)"]})}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),We(t.currentTarget),je(l=>!l)},className:"ml-1 p-1 rounded-md text-gray-800 hover:text-black hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-110",title:"Limit haqqƒ±nda",children:e.jsx(p,{name:"limit_info",size:18})})]})}),e.jsxs("div",{className:"hidden md:flex items-center gap-2",children:[e.jsx(p,{name:"sun",size:16,color:S.isDarkMode?"#9ca3af":"#fbbf24"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:S.isDarkMode,onChange:()=>S.toggleDarkMode(),className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"})]}),e.jsx(p,{name:"moon",size:16,color:S.isDarkMode?"#60a5fa":"#9ca3af"})]}),c?.user?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"hidden md:inline text-sm text-gray-600 dark:text-gray-300",children:["Salam, ",c.user.name]}),c.user.role?.name==="admin"&&e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(H,{href:"/admin",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-purple-600 to-indigo-600 text-white hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(p,{name:"settings",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Admin Panel"})]})}),e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(H,{href:"/profile",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 hover:from-gray-200 hover:to-gray-300 dark:from-gray-600 dark:to-gray-700 dark:text-gray-200 dark:hover:from-gray-500 dark:hover:to-gray-600 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(p,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Profil"})]})}),e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(H,{href:"/logout",method:"post",as:"button",className:"px-4 py-2.5 rounded-xl text-sm bg-gradient-to-r from-red-500 to-red-600 text-white hover:from-red-600 hover:to-red-700 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",children:[e.jsx(p,{name:"logout",size:16}),e.jsx("span",{className:"hidden md:inline",children:"√áƒ±xƒ±≈ü"})]})})]}):e.jsxs(e.Fragment,{children:[e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(H,{href:"/login",className:"px-4 py-2.5 rounded-xl text-sm bg-white/80 backdrop-blur-sm border-2 text-emerald-700 hover:bg-emerald-50 hover:border-emerald-300 dark:bg-gray-800/80 dark:text-emerald-400 dark:hover:bg-gray-700 dark:border-gray-600 dark:hover:border-emerald-500 transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 font-medium",style:{borderColor:_},children:[e.jsx(p,{name:"users",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Daxil ol"})]})}),e.jsx(x.div,{whileHover:{scale:1.05},whileTap:{scale:.95},children:e.jsxs(H,{href:"/register",className:"px-4 py-2.5 rounded-xl text-sm text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 bg-gradient-to-r hover:scale-105",style:{background:`linear-gradient(135deg, ${_}DD, ${ae}DD)`},children:[e.jsx(p,{name:"user_add",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Qeydiyyat"})]})})]}),e.jsxs(x.button,{whileHover:{scale:1.05,rotate:2},whileTap:{scale:.95},onClick:()=>{w(null),D([])},className:"px-4 py-2.5 rounded-xl text-sm text-white font-medium transition-all duration-300 shadow-lg hover:shadow-xl flex items-center gap-2 bg-gradient-to-r hover:brightness-110",style:{background:`linear-gradient(135deg, ${ae}DD, ${_}DD)`},children:[e.jsx(p,{name:"edit",size:16}),e.jsx("span",{className:"hidden md:inline",children:"Yeni s√∂hb…ôt"})]})]}),e.jsxs("div",{className:"flex md:hidden items-center gap-2 ml-auto overflow-x-auto",children:[c?.user?e.jsxs(e.Fragment,{children:[c.user.role?.name==="admin"&&e.jsx(H,{href:"/admin",className:"px-2 py-2 rounded-lg text-sm bg-purple-600 text-white hover:bg-purple-700 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(p,{name:"settings",size:16})}),e.jsx(H,{href:"/profile",className:"px-2 py-2 rounded-lg text-sm bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(p,{name:"users",size:16})}),e.jsx(H,{href:"/logout",method:"post",as:"button",className:"px-2 py-2 rounded-lg text-sm bg-red-500 text-white hover:bg-red-600 transition-colors shadow-sm flex items-center gap-1",children:e.jsx(p,{name:"logout",size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{href:"/login",className:"px-2 py-2 rounded-lg text-sm bg-white border text-emerald-700 hover:bg-emerald-50 dark:bg-gray-800 dark:text-emerald-400 dark:hover:bg-gray-700 transition-colors shadow-sm flex items-center gap-1",style:{borderColor:_},children:e.jsx(p,{name:"users",size:16})}),e.jsx(H,{href:"/register",className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:_},children:e.jsx(p,{name:"user_add",size:16})})]}),e.jsx("button",{onClick:()=>{w(null),D([])},className:"px-2 py-2 rounded-lg text-sm text-white transition-colors shadow-sm flex items-center gap-1",style:{backgroundColor:ae},title:"Yeni s√∂hb…ôt",children:e.jsx(p,{name:"edit",size:16})})]})]}),e.jsxs("div",{className:"flex gap-0 md:gap-4 h-full",children:[e.jsx(se,{children:E&&e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 md:hidden",onTouchStart:t=>{t.preventDefault(),U(!1)},onClick:()=>U(!1)})}),e.jsx(se,{children:(E||window.innerWidth>=768)&&e.jsxs(x.aside,{initial:{x:window.innerWidth<768?-320:0,opacity:window.innerWidth<768?0:1},animate:{x:0,opacity:1},exit:{x:-320,opacity:0},transition:{type:"spring",stiffness:400,damping:25,mass:.6,duration:.4},className:`
                  fixed md:relative
                  top-0 left-0
                  h-full
                  w-80 md:w-72 lg:w-80
                  bg-gradient-to-b from-white via-white to-gray-50 dark:from-gray-800 dark:via-gray-800 dark:to-gray-900
                  backdrop-blur-xl
                  border-r border-gray-200 dark:border-gray-700
                  rounded-r-3xl md:rounded-3xl
                  z-50 md:z-auto
                  flex flex-col
                  shadow-2xl md:shadow-xl
                `,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx(x.div,{initial:{opacity:0,y:-20,scale:.9},animate:{opacity:1,y:0,scale:1},transition:{delay:.15,duration:1,type:"spring",stiffness:200,damping:20},className:"md:hidden p-4 bg-gradient-to-r from-indigo-50/50 to-purple-50/50 dark:from-indigo-900/20 dark:to-purple-900/20 border-b border-gray-100 dark:border-gray-700/50 rounded-tr-3xl",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.brand_mode==="logo"&&(Se||s.brand_logo_url)?e.jsx(x.img,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,duration:.8,type:"spring",stiffness:200},whileHover:{scale:1.1,rotate:5,transition:{duration:.2}},whileTap:{scale:.95},src:Se||s.brand_logo_url,alt:"logo",className:"w-7 h-7 object-contain rounded-lg shadow-md border border-white/30 dark:border-gray-600/50"}):s.brand_mode==="icon"?e.jsx(x.div,{initial:{scale:0,rotate:-180},animate:{scale:1,rotate:0},transition:{delay:.3,duration:.8,type:"spring",stiffness:200},whileHover:{scale:1.1,rotate:5,transition:{duration:.2}},whileTap:{scale:.95},className:"p-1.5 rounded-lg bg-gradient-to-br from-purple-500/15 to-indigo-500/15 border border-purple-200/40 dark:border-purple-700/40 shadow-md",children:e.jsx(p,{name:s.brand_icon_name||"nav_chat",size:20,color:_})}):null,e.jsx(x.span,{initial:{opacity:0,x:-30},animate:{opacity:1,x:0},transition:{delay:.5,duration:.8,type:"spring",stiffness:150},whileHover:{scale:1.02,x:2,transition:{duration:.2}},className:"font-bold text-lg bg-gradient-to-r from-gray-800 via-gray-700 to-gray-800 dark:from-gray-100 dark:via-gray-200 dark:to-gray-100 bg-clip-text text-transparent truncate leading-tight",children:ce})]})}),e.jsxs(x.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},transition:{delay:.8,duration:.5},className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between bg-gradient-to-r from-purple-50/30 to-indigo-50/30 dark:from-purple-900/10 dark:to-indigo-900/10 md:rounded-t-3xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x.div,{whileHover:{scale:1.1,rotate:5},children:e.jsx(p,{name:"chat_history",size:24,color:_})}),e.jsx("h2",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 uppercase tracking-wider",children:"S√∂hb…ôt Tarix√ß…ôsi"})]}),e.jsx(x.button,{whileHover:{scale:1.1,rotate:90},whileTap:{scale:.9},onTouchStart:t=>{t.preventDefault(),t.stopPropagation(),U(!1)},onClick:t=>{t.preventDefault(),t.stopPropagation(),U(!1)},className:"md:hidden p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-colors active:bg-gray-200 dark:active:bg-gray-600 shadow-sm",type:"button","aria-label":"Baƒüla",children:e.jsx(p,{name:"close",size:20})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-1 custom-scrollbar",children:[(c?.user?Pe:ke).map((t,l)=>e.jsx(x.button,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:l*.05,duration:.3},whileHover:{scale:1.02,x:4},whileTap:{scale:.98},onClick:()=>{vt(t.session_id),window.innerWidth<768&&U(!1)},className:`
                        group w-full text-left px-3 py-2.5 rounded-xl transition-all
                        ${j===t.session_id?"bg-gradient-to-r from-emerald-50 to-emerald-100/50 dark:from-gray-700 dark:to-gray-600 border-l-4 shadow-md":"hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:shadow-sm"}
                      `,style:j===t.session_id?{borderLeftColor:_}:{},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 truncate",children:t.title||t.session_id.slice(0,8)}),t.created_at&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",children:new Date(t.created_at).toLocaleDateString("az")})]}),e.jsx(x.button,{whileHover:{scale:1.2},whileTap:{scale:.9},onClick:d=>{d.stopPropagation(),Ie(t),Me(!0)},className:"opacity-0 group-hover:opacity-100 p-1.5 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-all",title:"S√∂hb…ôti sil",children:e.jsx(p,{name:"close",size:16,className:"text-red-500"})})]})},t.session_id)),(c?.user?Pe:ke).length===0&&e.jsxs(x.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},transition:{delay:.2},className:"text-center py-12",children:[e.jsx(p,{name:"chat",size:48,color:S.isDarkMode?"#6b7280":"#d1d5db",className:"mx-auto mb-3"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"He√ß bir s√∂hb…ôt yoxdur"})]})]}),e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.15},className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gradient-to-r from-purple-50/30 to-indigo-50/30 dark:from-purple-900/10 dark:to-indigo-900/10 rounded-br-3xl md:rounded-b-3xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{name:"chat",size:18,color:_}),e.jsx("span",{className:"text-xs font-medium text-gray-600 dark:text-gray-400",children:"√úmumi s√∂hb…ôtl…ôr"})]}),e.jsx(x.div,{whileHover:{scale:1.15},className:"flex items-center justify-center min-w-[28px] h-7 px-2.5 rounded-full text-xs font-bold text-white shadow-lg",style:{backgroundColor:_},children:(c?.user?Pe:ke).length})]})})]})}),e.jsx("div",{className:"flex-1 min-w-0 w-full",children:e.jsx("main",{className:"w-full max-w-none",children:e.jsxs("div",{className:`w-full backdrop-blur-xl border border-emerald-200 dark:border-gray-600 rounded-3xl p-3 md:p-6 flex flex-col shadow-2xl hover:shadow-3xl dark:shadow-purple-500/10 border-white/20 dark:border-gray-700/30 transition-all duration-300 relative ${qe==="transparent"?"bg-white/95 dark:!bg-gray-800/95":"dark:!bg-gray-800/95"}`,"data-chat-background":"true",id:"chat-container",style:{minHeight:"calc(100vh - 200px)",background:qe!=="transparent"?qe:void 0,backgroundSize:f?.chat_background_type==="image"?"cover":void 0,backgroundPosition:f?.chat_background_type==="image"?"center":void 0,backgroundRepeat:f?.chat_background_type==="image"?"no-repeat":void 0},children:[e.jsxs("div",{className:"absolute top-2 right-2 z-20",children:[e.jsx("button",{onClick:()=>xt(t=>!t),className:"p-2 rounded-lg bg-white/80 dark:bg-gray-700/80 border border-gray-200 dark:border-gray-600 shadow hover:shadow-md transition",title:"M…ôtn √∂l√ß√ºs√º",children:e.jsx(p,{name:"type",size:16})}),pt&&e.jsxs("div",{className:"absolute right-0 mt-2 w-56 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3",children:[e.jsx("div",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-2",children:"M…ôtn √∂l√ß√ºs√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:J,onChange:t=>Ne(parseFloat(t.target.value)),className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>Ne(.95),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>Ne(1),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A"}),e.jsx("button",{onClick:()=>Ne(1.2),className:"px-2 py-1 text-xs rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsxs("div",{ref:L,className:"flex-1 overflow-y-auto space-y-3 pr-1 md:pr-2 custom-scrollbar",style:{maxHeight:"calc(100vh - 240px)"},children:[e.jsx(se,{children:N.map((t,l)=>e.jsxs(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.2},className:`group relative max-w-[90%] md:max-w-[85%] rounded-xl px-3 md:px-4 py-2 md:py-3 ${t.role==="user"?"ml-auto bg-emerald-50/60 dark:bg-emerald-900/20":"mr-auto bg-gray-100/60 dark:bg-gray-700/50"} shadow-lg hover:shadow-xl dark:shadow-2xl dark:hover:shadow-3xl border border-emerald-100 dark:border-gray-600 backdrop-blur-md transition-all duration-300 hover:-translate-y-0.5`,style:{},children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:t.role==="user"?e.jsx("div",{className:"flex items-center gap-2",children:c?.user?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:_},children:c.user.name}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:_},children:"Siz - Qonaq"})}):e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-2 py-1 rounded-full text-xs font-medium text-white",style:{backgroundColor:ae},children:Je||"AI Assistant"}),e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse",title:"AI Aktiv"})]})}),t.created_at&&e.jsxs("div",{className:"text-xs text-gray-400 flex flex-col items-end",children:[e.jsx("span",{className:"hidden md:block",children:new Date(t.created_at).toLocaleDateString("az-AZ",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx("span",{children:new Date(t.created_at).toLocaleTimeString("az-AZ",{hour:"2-digit",minute:"2-digit"})})]})]}),e.jsxs("div",{className:"absolute top-1.5 right-1.5 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>yt(Ue===(t.id||l)?null:t.id||l),className:"p-1.5 rounded-full bg-white/90 dark:bg-gray-800/90 border border-gray-200 dark:border-gray-600 shadow",title:"Mesaj m…ôtni √∂l√ß√ºs√º",children:e.jsx(p,{name:"type",size:12})}),Ue===(t.id||l)&&e.jsxs("div",{className:"absolute right-0 mt-2 w-44 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 shadow-lg p-3 z-10",children:[e.jsx("div",{className:"text-[11px] font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Bu mesaj √º√ß√ºn √∂l√ß√º"}),e.jsx("input",{type:"range",min:"0.85",max:"1.4",step:"0.05",value:$e.get(t.id)??J,onChange:d=>{const o=parseFloat(d.target.value);_e(u=>{const h=new Map(u);return h.set(t.id,o),h})},className:"w-full"}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("button",{onClick:()=>_e(d=>{const o=new Map(d);return o.set(t.id,Math.max(.85,(o.get(t.id)??J)-.05)),o}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A-"}),e.jsx("button",{onClick:()=>_e(d=>{const o=new Map(d);return o.set(t.id,J),o}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"Sƒ±fƒ±rla"}),e.jsx("button",{onClick:()=>_e(d=>{const o=new Map(d);return o.set(t.id,Math.min(1.4,(o.get(t.id)??J)+.05)),o}),className:"px-2 py-1 text-[11px] rounded bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200",children:"A+"})]})]})]}),e.jsx("div",{className:"whitespace-pre-wrap leading-relaxed text-gray-800 dark:text-gray-200",style:{fontSize:`${$e.get(t.id)??J}rem`},children:t.role==="assistant"?ot.has(t.id)?e.jsx(Bt,{text:t.fullContent,speed:wt,onComplete:()=>{D(d=>{const o=d.map(u=>u.id===t.id?{...u,content:t.fullContent,isTyping:!1}:u);return!c?.user&&j&&setTimeout(()=>{Ze(j,null,o)},100),o}),ve(d=>{const o=new Set(d);return o.delete(t.id),o}),ee(!1)}}):e.jsx(Ht,{content:t.content||""}):e.jsx("div",{className:"whitespace-pre-wrap",style:{fontSize:`${$e.get(t.id)??J}rem`},children:t.content})}),t.role==="assistant"&&!t.isTyping&&e.jsxs("div",{className:"flex items-center justify-start md:justify-between mt-2 flex-wrap gap-1 md:gap-2",children:[(()=>{const d=String(t.id||"");return!(Oe.has(d)||te.has(t.id))})()&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>tt(String(t.id||""),t.content||t.fullContent,"like"),disabled:te.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${te.get(t.id)==="like"?"text-green-600 bg-green-50 dark:bg-green-900/30":"text-gray-400 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/30"} disabled:opacity-50`,title:"B…ôy…ôn",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{name:"heart",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:te.get(t.id)==="like"?"B…ôy…ôndiniz":"B…ôy…ôn"})]})}),e.jsx("button",{onClick:()=>tt(String(t.id||""),t.content||t.fullContent,"dislike"),disabled:te.has(t.id),className:`p-1 md:p-1.5 rounded-lg transition-all group/btn ${te.get(t.id)==="dislike"?"text-red-600 bg-red-50 dark:bg-red-900/30":"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30"} disabled:opacity-50`,title:"B…ôy…ônm…ô",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{name:"dislike",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:te.get(t.id)==="dislike"?"B…ôy…ônm…ôdiniz":"B…ôy…ônm…ô"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2 opacity-75 hover:opacity-100 transition-opacity",children:[t.ragMeta?.dominant_kb_id!=null&&e.jsx("button",{onClick:()=>St(t),className:"px-2 py-1 md:px-3 md:py-1.5 rounded-lg text-xs md:text-sm bg-emerald-600 text-white hover:bg-emerald-700 transition-colors shadow",title:"Daha √ßox m…ôlumat ver",children:"Daha √ßox m…ôlumat ver"}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t.content||t.fullContent),r.success("M…ôtn kopyalandƒ±!")},className:"p-1 md:p-1.5 text-gray-400 hover:text-emerald-500 hover:bg-emerald-50 rounded-lg transition-all group/btn",title:"M…ôtn kopyala",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{name:"copy",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Kopyala"})]})}),e.jsx("button",{onClick:()=>{r.success("Geribildiri≈üiniz g√∂nd…ôrilir..."),(async()=>{try{const o=t.id,u=o!=null?String(o):void 0,h={message_content:t.content||t.fullContent,session_id:j,timestamp:t.created_at,user_info:c?.user?{name:c.user.name,email:c.user.email}:"Qonaq istifad…ô√ßi"};u!==void 0&&(h.message_id=u);const q=await F.post("/chat/report-feedback",h);setTimeout(()=>{r.success("Geribildiri≈üiniz g√∂nd…ôrildi!")},1e3)}catch(o){console.error("Feedback report error:",o);const u=o.response?.data?.message||o.response?.data?.error||"X…ôta ba≈ü verdi";setTimeout(()=>{r.error("Geribildiri≈ü g√∂nd…ôrilm…ôdi: "+u)},1e3)}})()},className:"p-1 md:p-1.5 text-gray-400 hover:text-orange-500 hover:bg-orange-50 rounded-lg transition-all group/btn",title:"S…ôhv cavab haqqƒ±nda bildi≈ü g√∂nd…ôr",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{name:"warning",size:14}),e.jsx("span",{className:"hidden md:inline text-xs opacity-0 group-hover/btn:opacity-100 transition-opacity whitespace-nowrap",children:"Bildir"})]})})]})]})]},t.id||l))}),g&&e.jsx(Et,{chatbotName:Je}),g&&He&&e.jsx("div",{className:"mt-1 text-[12px] italic text-gray-500 dark:text-gray-400",children:He})]}),e.jsx("div",{className:"mt-3 md:mt-4",children:e.jsxs("div",{className:"relative bg-white/50 dark:bg-gray-800/50 backdrop-blur-lg rounded-2xl border border-white/30 dark:border-gray-700/30 shadow-2xl hover:shadow-3xl transition-all duration-300 p-1",children:[e.jsxs("div",{className:"relative flex items-end gap-2",children:[e.jsx("textarea",{ref:ie,className:`flex-1 bg-transparent border-none outline-none focus:outline-none focus:ring-0 resize-none text-sm md:text-base p-3 placeholder-gray-500 dark:placeholder-gray-400 text-gray-900 dark:text-gray-100 min-h-[50px] max-h-[150px] ${K&&Z?"text-red-600 placeholder-red-400":""} ${G||A?"opacity-50 cursor-not-allowed":""}`,placeholder:le?`Limit doldu - ${Qe(de)}`:A?"√áatbot yazƒ±r... g√∂zl…ôyin":G?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin...":"Mesajƒ±nƒ±zƒ± yazƒ±n...",value:R,onChange:t=>{if(!G&&!A){const l=t.target.value;fe(re>0?l.slice(0,re):l)}try{const l=ie.current;if(l){l.style.height="auto";const d=(window.innerWidth<768,150);l.style.height=Math.min(l.scrollHeight,d)+"px"}}catch{}},onInput:()=>{try{const t=ie.current;if(t){t.style.height="auto";const l=(window.innerWidth<768,150);t.style.height=Math.min(t.scrollHeight,l)+"px"}}catch{}},onKeyDown:Pt,disabled:G,rows:2}),e.jsxs("div",{className:"flex items-center gap-1 pb-3 pr-1",children:[e.jsx("button",{onClick:()=>st(!ne),className:`p-2 rounded-lg transition-all shadow-sm hover:shadow-md border backdrop-blur-sm ${ne?"bg-emerald-500/90 text-white border-emerald-400/50 shadow-emerald-500/25":"bg-white/70 dark:bg-gray-700/70 text-gray-600 dark:text-gray-300 border-gray-300/50 dark:border-gray-600/50"}`,title:ne?"Enter il…ô g√∂nd…ôr aktiv":"Enter il…ô g√∂nd…ôr deaktiv",children:e.jsx(p,{name:"enter",size:14})}),e.jsx("button",{onClick:()=>Y||A?et():Ve(),disabled:K&&Z||G,className:"p-3 rounded-xl text-white font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-all shadow-lg hover:shadow-xl hover:scale-105 backdrop-blur-sm",style:{backgroundColor:Y||A||K&&Z||G?"#ef4444":_,boxShadow:`0 4px 20px ${Y||A?"#ef444420":`${_}20`}`},title:Y||A?"Dayandƒ±r":G?"ƒ∞stifad…ô ≈ü…ôrtl…ôrini q…ôbul edin":"G√∂nd…ôr",children:e.jsx(p,{name:Y||A?"stop":G?"shield_check":"send",size:16})})]})]}),e.jsx("div",{className:"absolute -bottom-12 right-2",children:e.jsxs("div",{className:"group relative inline-flex items-center justify-center",children:[e.jsx("span",{className:"absolute inline-flex h-full w-full rounded-xl bg-gradient-to-r opacity-75 animate-ping",style:{backgroundImage:`linear-gradient(135deg, ${_}40, ${ae}40)`,animationDuration:"2s"}}),e.jsx("span",{className:"absolute inline-flex h-full w-full rounded-xl bg-gradient-to-r opacity-75 animate-pulse",style:{backgroundImage:`linear-gradient(135deg, ${_}30, ${ae}30)`,animationDuration:"1.5s"}}),e.jsx("button",{type:"button",onClick:()=>Xe(!0),className:"relative p-3 rounded-xl text-white font-medium flex items-center justify-center transition-all shadow-lg hover:shadow-xl hover:scale-105 backdrop-blur-sm cursor-pointer",style:{backgroundColor:_,boxShadow:`0 4px 20px ${_}20`},title:"Parametrl…ôr",children:e.jsx(p,{name:"settings",size:16,className:"animate-spin-slow",style:{animationDuration:"8s"}})})]})})]})}),e.jsxs("div",{className:"mt-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`text-xs transition-all text-gray-800 ${K&&Z?"text-red-600 font-medium":K&&Ye<50?"text-yellow-600":"dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]"}`,children:"Daxiletm…ô limiti:"}),e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2.5rem] h-6 px-2 rounded-full text-xs font-bold text-white shadow-sm transition-all",style:{backgroundColor:K&&Z?"#ef4444":K&&Ye<50?"#eab308":ae},children:re}),e.jsx("span",{className:"text-xs text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"simvol"}),me>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"|"}),e.jsx("span",{className:"text-xs text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"istifad…ô:"}),e.jsx("span",{className:"inline-flex items-center justify-center min-w-[2.5rem] h-6 px-2 rounded-full text-xs font-bold text-white shadow-sm transition-all",style:{backgroundColor:K&&Z?"#ef4444":_},children:me})]})]}),K&&Z&&e.jsxs("p",{className:"text-xs text-red-600 font-medium flex items-center gap-1",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-5 h-5 rounded-full bg-red-100 dark:bg-red-900/30",children:"‚ö†Ô∏è"}),"Limit ke√ßildi!"]})]}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs("p",{className:"text-xs text-gray-600 dark:text-gray-400 px-4 py-2 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg inline-block",children:["‚ö†Ô∏è ",kt]})}),e.jsx("p",{className:"text-xs mt-1 text-center text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:ne?e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"g√∂nd…ôr"}),", ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Shift+Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"yeni s…ôtir"})]}):e.jsxs("span",{children:[e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"Enter"})," - ",e.jsx("strong",{className:"text-gray-800 dark:!text-white dark:drop-shadow-[0_1px_2px_rgba(0,0,0,0.8)]",children:"yeni s…ôtir"})]})})]})})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx(Mt,{footerSettings:b})})]}),e.jsx($t,{}),e.jsx(Lt,{isOpen:gt,onAccept:jt,onReject:Nt,siteName:ce}),it&&It.createPortal(e.jsxs("div",{className:"fixed inset-0 z-[9999]",onClick:()=>je(!1),children:[e.jsx("div",{className:"absolute inset-0"}),e.jsxs("div",{className:"absolute w-[18rem] md:w-[20rem] p-3 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-2xl text-xs text-gray-700 dark:text-gray-200 limit-popover-animate backdrop-blur-lg",style:{top:Ge.top,left:Ge.left},onClick:t=>t.stopPropagation(),children:[e.jsx("div",{className:"font-semibold mb-1",children:"Limit qaydasƒ±"}),B.limit_type==="monthly"?e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"Aylƒ±q limit 30 g√ºnd…ôn bir b…ôrpa olunur. ƒ∞lk mesaj g√∂nd…ôrdiyiniz vaxt ba≈ülanƒüƒ±c n√∂qt…ôsidir."}),e.jsx("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:"N√ºmun…ô: ƒ∞lk mesajƒ± bu g√ºn 14:00-da g√∂nd…ôrmisinizs…ô, n√∂vb…ôti b…ôrpa 30 g√ºn sonra eyni tarix v…ô saatda olacaq."}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",B.monthly_reset_time?new Date(B.monthly_reset_time).toLocaleString("az-AZ"):"H…ôl…ô ba≈ülanmayƒ±b"]})]}):e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"G√ºnl√ºk limit yalnƒ±z 0-a d√º≈üd√ºkd…ô 24 saatlƒ±q geri sayƒ±m ba≈ülayƒ±r."}),e.jsxs("p",{className:"text-[11px] text-gray-500 dark:text-gray-400",children:["N√ºmun…ô: D√ºn…ôn 14:00-da istifad…ô etdiniz v…ô h…ôl…ô ",B.daily_remaining??B.remaining," qalƒ±bsa, sabah 14:00-da yenil…ônmir. 0 etdiyiniz andan 24 saat sonra b…ôrpa olacaq."]}),e.jsxs("p",{className:"mt-1",children:["N√∂vb…ôti b…ôrpa: ",B.reset_time?new Date(B.reset_time).toLocaleString("az-AZ"):"Limit bitm…ôyib"]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"font-semibold mb-0.5",children:"‚ÄúSorƒüu‚Äù n…ôdir?"}),e.jsx("p",{children:"H…ôr g√∂nd…ôrdiyiniz mesaj 1 sorƒüudur."})]})]})]}),document.body),e.jsx(At,{isOpen:ut,onConfirm:bt,onCancel:ft,chatTitle:X?.title||X?.session_id?.slice(0,8)||"",siteName:ce}),e.jsx(qt,{isOpen:ht,onClose:()=>Xe(!1),isAuthenticated:!!c?.user})]})})}export{Vt as default};
